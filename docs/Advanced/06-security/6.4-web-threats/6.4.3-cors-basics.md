---
title: "6.4.3 CORS：跨域請求安全策略"
typora-root-url: ../../public
---

# 6.4.3 CORS：跨域請求安全策略

## 一句話破題

CORS 是瀏覽器在問服務器："這個來自別的網站的請求，你允許嗎？" 它不是在刁難你，而是在保護用戶。

## 核心價值

理解 CORS 能讓你：
- 知道爲什麼跨域請求會被阻止
- 正確配置允許的跨域來源
- 避免"開發時好好的，上線就報錯"

## 快速上手

### 最小配置

```typescript
// app/api/data/route.ts
export async function GET() {
  return Response.json({ data: 'hello' }, {
    headers: {
      'Access-Control-Allow-Origin': 'https://your-frontend.com',
    }
  })
}

export async function OPTIONS() {
  return new Response(null, {
    headers: {
      'Access-Control-Allow-Origin': 'https://your-frontend.com',
      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type',
    }
  })
}
```

### 多域名白名單

```typescript
const allowedOrigins = [
  'https://app.example.com',
  'https://admin.example.com',
]

export async function GET(request: Request) {
  const origin = request.headers.get('origin')
  const headers: Record<string, string> = {}
  
  if (origin && allowedOrigins.includes(origin)) {
    headers['Access-Control-Allow-Origin'] = origin
  }
  
  return Response.json({ data: 'hello' }, { headers })
}
```

### 允許攜帶憑證

```typescript
// 需要發送 Cookie 時
headers: {
  'Access-Control-Allow-Origin': 'https://your-frontend.com', // 不能用 *
  'Access-Control-Allow-Credentials': 'true',
}

// 前端請求
fetch(url, { credentials: 'include' })
```

## 避坑指南

::: danger 新手最容易犯的錯
1. 生產環境使用 `Access-Control-Allow-Origin: *`
2. 使用 `*` 的同時又設置 `Allow-Credentials: true`
3. 忘記處理 OPTIONS 預檢請求
:::
