---
title: "6.1.3 GitHub 登錄怎麼接——GitHub 登錄：OAuth Apps 快速接入"
typora-root-url: ../../public
---

# 6.1.3 GitHub 登錄怎麼接——GitHub OAuth 實戰

## 一句話破題

GitHub OAuth 是開發者最友好的登錄方式——註冊應用只需要 2 分鐘，配置比 Google 簡單得多。

## 爲什麼推薦 GitHub 登錄

| 特性 | GitHub | Google |
|------|--------|--------|
| 註冊複雜度 | 簡單 | 需要項目+同意屏幕 |
| 審覈要求 | 無 | 測試模式需添加用戶 |
| 開發者友好度 | 極高 | 一般 |
| 適用場景 | 技術產品 | 通用產品 |

## 步驟一：創建 GitHub OAuth App

1. 登錄 GitHub → 右上角頭像 → **Settings**
2. 左側菜單最底部 → **Developer settings**
3. 選擇 **OAuth Apps** → **New OAuth App**
4. 填寫應用信息：

| 字段 | 開發環境 | 生產環境 |
|------|----------|----------|
| Application name | My Dev App | My Production App |
| Homepage URL | `http://localhost:3000` | `https://your-domain.com` |
| Authorization callback URL | `http://localhost:3000/api/auth/callback/github` | `https://your-domain.com/api/auth/callback/github` |

5. 點擊 **Register application**
6. 創建成功後，點擊 **Generate a new client secret**
7. 複製 **Client ID** 和 **Client Secret**

::: danger 重要
Client Secret 只顯示一次！立即複製保存，否則需要重新生成。
:::

## 步驟二：配置環境變量

```bash
# .env.local
GITHUB_ID=your-github-client-id
GITHUB_SECRET=your-github-client-secret
```

## 步驟三：NextAuth 配置

```typescript
// app/api/auth/[...nextauth]/route.ts
import NextAuth from "next-auth"
import GitHubProvider from "next-auth/providers/github"

const handler = NextAuth({
  providers: [
    GitHubProvider({
      clientId: process.env.GITHUB_ID!,
      clientSecret: process.env.GITHUB_SECRET!,
    }),
  ],
})

export { handler as GET, handler as POST }
```

## 獲取用戶的 GitHub 數據

GitHub 返回的用戶信息包含：

```typescript
interface GitHubProfile {
  id: number
  login: string        // GitHub 用戶名
  name: string | null  // 顯示名稱
  email: string | null // 郵箱（可能爲空）
  avatar_url: string   // 頭像
  html_url: string     // GitHub 主頁
}
```

### 獲取用戶郵箱

有些用戶的郵箱是私有的，需要額外配置 scope：

```typescript
GitHubProvider({
  clientId: process.env.GITHUB_ID!,
  clientSecret: process.env.GITHUB_SECRET!,
  authorization: {
    params: {
      scope: "read:user user:email",
    },
  },
})
```

### 在 Callback 中處理

```typescript
callbacks: {
  async signIn({ user, account, profile }) {
    // profile 包含 GitHub 返回的原始數據
    const githubProfile = profile as {
      login: string
      html_url: string
    }
    
    console.log("GitHub 用戶名:", githubProfile.login)
    console.log("GitHub 主頁:", githubProfile.html_url)
    
    return true
  },
}
```

## 同時支持 Google 和 GitHub

```typescript
import NextAuth from "next-auth"
import GoogleProvider from "next-auth/providers/google"
import GitHubProvider from "next-auth/providers/github"

const handler = NextAuth({
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    GitHubProvider({
      clientId: process.env.GITHUB_ID!,
      clientSecret: process.env.GITHUB_SECRET!,
    }),
  ],
})

export { handler as GET, handler as POST }
```

用戶點擊登錄時，NextAuth 會自動顯示所有可用的登錄選項。

## GitHub Apps vs OAuth Apps

GitHub 提供兩種應用類型：

| 特性 | OAuth Apps | GitHub Apps |
|------|------------|-------------|
| 用途 | 用戶認證 | 倉庫/組織集成 |
| 權限粒度 | 粗 | 細 |
| 安裝方式 | 用戶授權 | 組織/倉庫安裝 |
| NextAuth 支持 | ✅ | 需額外配置 |

**對於登錄場景，使用 OAuth Apps 即可。**

## 常見問題

### 回調地址錯誤

```
The redirect_uri MUST match the registered callback URL
```

**解決**：確保 GitHub OAuth App 中的 callback URL 與 `NEXTAUTH_URL` 完全一致，包括協議（http/https）和端口號。

### 獲取不到用戶郵箱

**原因**：用戶在 GitHub 設置中將郵箱設爲私有

**解決**：
1. 添加 `user:email` scope
2. 或者在註冊流程中要求用戶手動填寫郵箱
