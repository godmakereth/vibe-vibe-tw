---
title: "3.7.3 白屏時該怎麼辦——加載狀態：Skeleton/Spinner 組件"
typora-root-url: ../../public
---

# 3.7.3 加載狀態

### 一句話破題

Skeleton 讓用戶知道內容馬上就來，比 Spinner 更能緩解等待焦慮。

### 核心價值

空白頁面讓用戶以爲頁面壞了。合適的加載狀態可以：降低感知等待時間、保持視覺佈局穩定、提升用戶信心。

### Spinner vs Skeleton

| 特性 | Spinner | Skeleton |
|-----|---------|----------|
| 適用場景 | 操作反饋、短時等待 | 頁面加載、列表加載 |
| 視覺效果 | 集中注意力 | 分散注意力 |
| 佈局穩定性 | 可能跳動 | 預留位置，無跳動 |
| 感知時間 | 感覺更長 | 感覺更短 |

### Skeleton 組件

```tsx
// components/Skeleton.tsx
import { cn } from '@/lib/utils'

interface SkeletonProps {
  className?: string
  width?: string | number
  height?: string | number
}

export function Skeleton({ className, width, height }: SkeletonProps) {
  return (
    <div
      className={cn(
        'animate-pulse rounded bg-gray-200',
        className
      )}
      style={{ width, height }}
    />
  )
}

// 文本骨架
export function SkeletonText({ lines = 3 }: { lines?: number }) {
  return (
    <div className="space-y-2">
      {Array.from({ length: lines }).map((_, i) => (
        <Skeleton 
          key={i} 
          className="h-4" 
          style={{ width: i === lines - 1 ? '60%' : '100%' }}
        />
      ))}
    </div>
  )
}

// 頭像骨架
export function SkeletonAvatar({ size = 40 }: { size?: number }) {
  return (
    <Skeleton 
      className="rounded-full" 
      width={size} 
      height={size} 
    />
  )
}
```

### 頁面級 Skeleton

```tsx
// components/skeletons/PostCardSkeleton.tsx
export function PostCardSkeleton() {
  return (
    <div className="p-4 border rounded-lg">
      <div className="flex items-center gap-3 mb-4">
        <SkeletonAvatar size={32} />
        <div className="flex-1">
          <Skeleton className="h-4 w-24 mb-1" />
          <Skeleton className="h-3 w-16" />
        </div>
      </div>
      <Skeleton className="h-6 w-3/4 mb-2" />
      <SkeletonText lines={2} />
      <div className="flex gap-4 mt-4">
        <Skeleton className="h-4 w-12" />
        <Skeleton className="h-4 w-12" />
      </div>
    </div>
  )
}

// 列表骨架
export function PostListSkeleton({ count = 3 }: { count?: number }) {
  return (
    <div className="space-y-4">
      {Array.from({ length: count }).map((_, i) => (
        <PostCardSkeleton key={i} />
      ))}
    </div>
  )
}
```

### Next.js loading.tsx

```tsx
// app/posts/loading.tsx
import { PostListSkeleton } from '@/components/skeletons/PostCardSkeleton'

export default function Loading() {
  return (
    <div className="container py-8">
      <Skeleton className="h-8 w-48 mb-6" />
      <PostListSkeleton count={5} />
    </div>
  )
}
```

### Spinner 組件

```tsx
// components/Spinner.tsx
import { cn } from '@/lib/utils'

interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg'
  className?: string
}

const sizes = {
  sm: 'w-4 h-4',
  md: 'w-6 h-6',
  lg: 'w-8 h-8',
}

export function Spinner({ size = 'md', className }: SpinnerProps) {
  return (
    <svg
      className={cn('animate-spin text-blue-500', sizes[size], className)}
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        className="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        strokeWidth="4"
      />
      <path
        className="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
      />
    </svg>
  )
}

// 全屏加載
export function FullPageSpinner() {
  return (
    <div className="fixed inset-0 flex items-center justify-center bg-white/80">
      <Spinner size="lg" />
    </div>
  )
}
```

### 按鈕加載狀態

```tsx
// components/Button.tsx
interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  loading?: boolean
  children: React.ReactNode
}

export function Button({ loading, children, disabled, ...props }: ButtonProps) {
  return (
    <button
      disabled={loading || disabled}
      className="relative px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
      {...props}
    >
      {loading && (
        <span className="absolute inset-0 flex items-center justify-center">
          <Spinner size="sm" className="text-white" />
        </span>
      )}
      <span className={loading ? 'invisible' : ''}>{children}</span>
    </button>
  )
}

// 使用
<Button loading={isSubmitting}>
  提交
</Button>
```

### Suspense 與加載狀態

```tsx
// app/posts/page.tsx
import { Suspense } from 'react'
import { PostListSkeleton } from '@/components/skeletons/PostCardSkeleton'

export default function PostsPage() {
  return (
    <div className="container py-8">
      <h1 className="text-2xl font-bold mb-6">文章列表</h1>
      
      <Suspense fallback={<PostListSkeleton />}>
        <PostList />
      </Suspense>
    </div>
  )
}

// 數據獲取組件
async function PostList() {
  const posts = await fetchPosts()
  return (
    <ul className="space-y-4">
      {posts.map((post) => (
        <PostCard key={post.id} post={post} />
      ))}
    </ul>
  )
}
```

### 漸進式加載

```tsx
// 先顯示重要內容，再加載次要內容
export default function PostPage({ params }: { params: { id: string } }) {
  return (
    <article>
      {/* 核心內容先加載 */}
      <Suspense fallback={<ArticleSkeleton />}>
        <ArticleContent id={params.id} />
      </Suspense>
      
      {/* 評論後加載 */}
      <Suspense fallback={<CommentsSkeleton />}>
        <Comments postId={params.id} />
      </Suspense>
      
      {/* 推薦內容最後加載 */}
      <Suspense fallback={<RecommendationsSkeleton />}>
        <RelatedPosts postId={params.id} />
      </Suspense>
    </article>
  )
}
```

### 加載狀態最佳實踐

**1. 匹配真實佈局**：

```tsx
// 差：通用骨架，加載完成後佈局跳動
<Skeleton className="h-40" />

// 好：精確匹配最終佈局
<div className="flex gap-4">
  <Skeleton className="w-24 h-24" />
  <div className="flex-1">
    <Skeleton className="h-6 w-3/4 mb-2" />
    <Skeleton className="h-4 w-1/2" />
  </div>
</div>
```

**2. 避免閃爍**：

```tsx
// 對於快速加載的內容，延遲顯示加載狀態
function useDelayedLoading(isLoading: boolean, delay = 200) {
  const [showLoading, setShowLoading] = useState(false)
  
  useEffect(() => {
    if (isLoading) {
      const timer = setTimeout(() => setShowLoading(true), delay)
      return () => clearTimeout(timer)
    }
    setShowLoading(false)
  }, [isLoading, delay])
  
  return showLoading
}
```

### AI 協作指南

**核心意圖**：讓 AI 幫你創建匹配頁面佈局的 Skeleton 組件。

**需求定義公式**：
- 目標頁面：[頁面名稱] 的加載骨架
- 佈局描述：[卡片/列表/表格] 佈局
- 關鍵元素：[頭像/標題/圖片/段落]

**示例 Prompt**：

```
請爲電商商品卡片創建 Skeleton 組件：
1. 包含商品圖片（正方形）
2. 商品標題（一行）
3. 價格（較大字號）
4. 兩個標籤（如包郵、新品）
使用 Tailwind CSS 的 animate-pulse
```

### 驗收清單

- [ ] 頁面級加載有 loading.tsx
- [ ] Skeleton 匹配真實佈局
- [ ] 按鈕有 loading 狀態
- [ ] 快速請求無閃爍
