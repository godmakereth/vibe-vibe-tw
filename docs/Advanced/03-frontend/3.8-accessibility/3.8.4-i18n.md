---
title: "3.8.4 外國人能用嗎——國際化：i18n 框架與多語言支持"
typora-root-url: ../../public
---

# 3.8.4 國際化 i18n

### 一句話破題

國際化是讓代碼支持多語言的架構，而不是把中文翻譯成英文那麼簡單。

### 核心價值

國際化 (i18n = internationalization, 首尾字母間18個字母) 是把文本從代碼中抽離出來，讓產品能夠支持任意語言，而無需修改代碼。

### Next.js + next-intl 方案

```bash
npm install next-intl
```

**目錄結構**：

```
src/
├── app/
│   └── [locale]/
│       ├── layout.tsx
│       └── page.tsx
├── messages/
│   ├── en.json
│   └── zh.json
└── i18n.ts
```

**配置文件**：

```ts
// i18n.ts
import { getRequestConfig } from 'next-intl/server'

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`./messages/${locale}.json`)).default
}))

// middleware.ts
import createMiddleware from 'next-intl/middleware'

export default createMiddleware({
  locales: ['en', 'zh'],
  defaultLocale: 'zh'
})

export const config = {
  matcher: ['/((?!api|_next|.*\\..*).*)']
}
```

### 翻譯文件

```json
// messages/zh.json
{
  "common": {
    "submit": "提交",
    "cancel": "取消",
    "loading": "加載中...",
    "error": "出錯了"
  },
  "home": {
    "title": "歡迎來到我們的網站",
    "description": "這是一個示例描述"
  },
  "auth": {
    "login": "登錄",
    "logout": "退出",
    "welcome": "歡迎回來，{name}！"
  }
}

// messages/en.json
{
  "common": {
    "submit": "Submit",
    "cancel": "Cancel",
    "loading": "Loading...",
    "error": "Something went wrong"
  },
  "home": {
    "title": "Welcome to our website",
    "description": "This is a sample description"
  },
  "auth": {
    "login": "Login",
    "logout": "Logout",
    "welcome": "Welcome back, {name}!"
  }
}
```

### 在組件中使用

```tsx
// app/[locale]/page.tsx
import { useTranslations } from 'next-intl'

export default function HomePage() {
  const t = useTranslations('home')
  const tCommon = useTranslations('common')
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
      <button>{tCommon('submit')}</button>
    </div>
  )
}

// 帶參數
function WelcomeMessage({ name }: { name: string }) {
  const t = useTranslations('auth')
  
  return <p>{t('welcome', { name })}</p>
  // 輸出: "歡迎回來，張三！" 或 "Welcome back, Zhang San!"
}
```

### 複數和性別

```json
// messages/en.json
{
  "cart": {
    "items": "{count, plural, =0 {No items} one {# item} other {# items}}",
    "total": "Total: {price}"
  }
}

// messages/zh.json
{
  "cart": {
    "items": "{count}件商品",
    "total": "總計: {price}"
  }
}
```

```tsx
function CartSummary({ count, total }: { count: number; total: string }) {
  const t = useTranslations('cart')
  
  return (
    <div>
      <p>{t('items', { count })}</p>
      <p>{t('total', { price: total })}</p>
    </div>
  )
}
// count=0: "No items" / "0件商品"
// count=1: "1 item" / "1件商品"  
// count=5: "5 items" / "5件商品"
```

### 日期和數字格式化

```tsx
import { useFormatter } from 'next-intl'

function FormattedContent() {
  const format = useFormatter()
  
  const date = new Date()
  const price = 1234.56
  
  return (
    <div>
      {/* 日期格式化 */}
      <p>{format.dateTime(date, { dateStyle: 'long' })}</p>
      {/* en: "January 15, 2024" / zh: "2024年1月15日" */}
      
      {/* 相對時間 */}
      <p>{format.relativeTime(date)}</p>
      {/* en: "2 hours ago" / zh: "2小時前" */}
      
      {/* 數字格式化 */}
      <p>{format.number(price, { style: 'currency', currency: 'CNY' })}</p>
      {/* en: "CN¥1,234.56" / zh: "￥1,234.56" */}
    </div>
  )
}
```

### 語言切換

```tsx
'use client'

import { useLocale } from 'next-intl'
import { useRouter, usePathname } from 'next/navigation'

function LanguageSwitcher() {
  const locale = useLocale()
  const router = useRouter()
  const pathname = usePathname()
  
  const switchLocale = (newLocale: string) => {
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`)
    router.push(newPath)
  }
  
  return (
    <select 
      value={locale} 
      onChange={(e) => switchLocale(e.target.value)}
      aria-label="選擇語言"
    >
      <option value="zh">中文</option>
      <option value="en">English</option>
    </select>
  )
}
```

### 服務端組件中使用

```tsx
// app/[locale]/page.tsx
import { getTranslations } from 'next-intl/server'

export async function generateMetadata({ params: { locale } }) {
  const t = await getTranslations({ locale, namespace: 'home' })
  
  return {
    title: t('title'),
    description: t('description'),
  }
}

export default async function Page() {
  const t = await getTranslations('home')
  
  return <h1>{t('title')}</h1>
}
```

### 翻譯鍵管理

```tsx
// 使用 TypeScript 類型安全
// 創建類型定義

// types/i18n.d.ts
import en from '../messages/en.json'

type Messages = typeof en

declare global {
  interface IntlMessages extends Messages {}
}
```

### AI 協作指南

**核心意圖**：讓 AI 幫你實現國際化架構。

**需求定義公式**：
- 框架選擇：Next.js + [next-intl/react-i18next]
- 支持語言：[中文/英文/日文...]
- 功能需求：[日期格式化/複數/性別]

**示例 Prompt**：

```
請幫我設置 Next.js + next-intl 國際化：
1. 支持中文和英文
2. 基於 URL 路徑切換語言 (/zh, /en)
3. 包含語言切換組件
4. 配置日期和貨幣格式化
5. 提供完整的目錄結構和配置文件
```

### 驗收清單

- [ ] 文本從代碼中抽離
- [ ] 支持語言切換
- [ ] 日期/數字正確格式化
- [ ] SEO 元數據多語言支持
- [ ] 翻譯鍵有 TypeScript 類型
