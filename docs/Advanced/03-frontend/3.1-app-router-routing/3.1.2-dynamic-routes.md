---
title: "3.1.2 如何給成千上萬的頁面做路由——動態路由：參數處理"
typora-root-url: ../../public
---

# 3.1.2 如何給成千上萬的頁面做路由——動態路由

### 一句話破題

用方括號 `[param]` 命名文件夾，即可創建動態路由，一套代碼服務無限頁面。

### 核心價值

博客有上千篇文章，商城有上萬個商品，用戶有數百萬個主頁——你不可能爲每個實體手動創建一個 `page.tsx`。動態路由讓一個頁面模板匹配無限多的 URL 路徑。

### 動態路由語法

| 語法 | 示例路徑 | 匹配 URL | params 值 |
|------|----------|----------|-----------|
| `[slug]` | `app/blog/[slug]/page.tsx` | `/blog/hello-world` | `{ slug: 'hello-world' }` |
| `[...slug]` | `app/docs/[...slug]/page.tsx` | `/docs/a/b/c` | `{ slug: ['a', 'b', 'c'] }` |
| `[[...slug]]` | `app/shop/[[...slug]]/page.tsx` | `/shop` 或 `/shop/a/b` | `{ slug: undefined }` 或 `{ slug: ['a', 'b'] }` |

### 快速上手

**基礎動態路由：**

```
app/
└── blog/
    └── [slug]/
        └── page.tsx    # 匹配 /blog/任意內容
```

**獲取動態參數：**

```tsx
// app/blog/[slug]/page.tsx
type Props = {
  params: { slug: string }
}

export default async function BlogPost({ params }: Props) {
  const { slug } = params
  
  // 根據 slug 獲取文章數據
  const post = await getPostBySlug(slug)
  
  if (!post) {
    notFound() // 觸發 not-found.tsx
  }
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

### Catch-all 路由

當你需要匹配多級路徑時，使用 `[...param]` 語法：

```tsx
// app/docs/[...slug]/page.tsx
// 匹配 /docs/getting-started
// 匹配 /docs/api/authentication/oauth

type Props = {
  params: { slug: string[] }
}

export default function DocsPage({ params }: Props) {
  // slug 是數組：['api', 'authentication', 'oauth']
  const breadcrumb = params.slug.join(' > ')
  
  return <div>當前路徑：{breadcrumb}</div>
}
```

### 靜態生成動態路由

對於 SEO 關鍵頁面，可以在構建時預生成所有可能的路徑：

```tsx
// app/blog/[slug]/page.tsx

// 告訴 Next.js 預先生成哪些路徑
export async function generateStaticParams() {
  const posts = await getAllPosts()
  
  return posts.map((post) => ({
    slug: post.slug,
  }))
}

// 頁面組件保持不變
export default async function BlogPost({ params }: Props) {
  // ...
}
```

```mermaid
graph LR
    A["構建時"] --> B["generateStaticParams"]
    B --> C["返回所有 slug"]
    C --> D["爲每個 slug 預渲染 HTML"]
    D --> E["靜態文件部署"]
    
    F["用戶訪問"] --> G["直接返回預渲染的 HTML"]
    G --> H["極速加載"]
```

### 搜索參數 vs 路由參數

除了路由參數，還可以通過 URL 查詢字符串傳遞數據：

```tsx
// URL: /products?category=electronics&sort=price

type Props = {
  params: { id: string }
  searchParams: { category?: string; sort?: string }
}

export default function ProductsPage({ searchParams }: Props) {
  const { category, sort } = searchParams
  
  return (
    <div>
      <p>分類: {category}</p>
      <p>排序: {sort}</p>
    </div>
  )
}
```

| 類型 | 用途 | 示例 |
|------|------|------|
| **路由參數** | 標識資源 | `/blog/my-post`（文章唯一標識） |
| **搜索參數** | 篩選/排序 | `/products?sort=price`（列表篩選條件） |

### AI 協作指南

**核心意圖**：讓 AI 幫你創建支持動態內容的頁面。

**需求定義公式**：
- 功能描述：我需要一個 [資源類型] 的詳情頁
- 交互方式：URL 格式爲 `/[資源名]/[標識符]`
- 預期效果：根據 URL 參數獲取並展示對應數據

**關鍵術語**：`[slug]`、`params`、`generateStaticParams`、`notFound`、`searchParams`

**交互策略**：
1. 先讓 AI 創建動態路由的文件結構
2. 讓它實現參數獲取和數據請求邏輯
3. 補充 404 處理和 loading 狀態
4. 如需 SSG，讓它添加 `generateStaticParams`

### 避坑指南

1. **動態參數是字符串**：即使 URL 是 `/post/123`，`params.id` 也是 `"123"` 而非 `123`
2. **catch-all 參數是數組**：`[...slug]` 返回的是 `string[]`，記得處理空數組情況
3. **`generateStaticParams` 返回值必須是對象數組**：`[{ slug: 'a' }, { slug: 'b' }]`
4. **動態路由默認是動態渲染**：除非使用 `generateStaticParams` 預生成

### 驗收清單

- [ ] 動態路由能正確匹配不同的 URL 路徑
- [ ] `params` 能正確獲取到 URL 中的動態部分
- [ ] 無效的動態參數能觸發 404 頁面
- [ ] 需要 SEO 的頁面已配置 `generateStaticParams`
