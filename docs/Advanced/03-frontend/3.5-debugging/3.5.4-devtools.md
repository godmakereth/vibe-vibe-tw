---
title: "3.5.4 組件狀態對不對——React DevTools：組件樹與狀態檢查"
typora-root-url: ../../public
---

# 3.5.4 組件狀態對不對——React DevTools

### 一句話破題

React DevTools 讓你像 X 光一樣透視組件樹——查看每個組件的 Props、State 和渲染原因。

### 核心價值

當 UI 不符合預期時，問題可能出在 Props 傳遞、State 管理或渲染邏輯。React DevTools 讓你直接檢查組件的運行時狀態，無需添加 console.log。

### 安裝 React DevTools

1. 在 Chrome 網上應用店搜索 "React Developer Tools"
2. 安裝擴展程序
3. 刷新你的 React 應用
4. DevTools 會多出 **Components** 和 **Profiler** 兩個面板

### Components 面板

**組件樹視圖**：

```
App
├── Layout
│   ├── Header
│   │   └── Navigation
│   └── Main
│       ├── Sidebar
│       └── Content
│           ├── ProductList
│           │   ├── ProductCard ← 選中
│           │   ├── ProductCard
│           │   └── ProductCard
│           └── Pagination
└── Footer
```

**右側面板顯示**：

- **props**：父組件傳入的屬性
- **hooks**：組件使用的 Hooks 及其當前值
- **rendered by**：是誰渲染了這個組件

### 檢查 Props

點擊任意組件，查看其接收的 Props：

```
ProductCard
├── props
│   ├── product: {id: 1, name: "iPhone", price: 999}
│   ├── onAddToCart: ƒ ()
│   └── isSelected: false
└── hooks
    └── State: 0
```

**調試技巧**：

- 點擊 Props 中的對象可以展開查看詳情
- 右鍵 → "Store as global variable" 可以在 Console 中訪問該值
- 直接在 DevTools 中修改 Props 值，立即看到 UI 變化

### 檢查 State

Hooks 區域顯示所有 useState/useReducer 的當前值：

```
hooks
├── State: "loading"           ← useState
├── State: [{...}, {...}]      ← useState
├── Reducer: {count: 5}        ← useReducer
├── Context: {theme: "dark"}   ← useContext
└── Memo: [1, 2, 3]            ← useMemo
```

**即時修改 State**：

雙擊 State 值可以直接修改，測試不同狀態下的 UI 表現。

### 搜索組件

頂部搜索框支持：

- 組件名：`ProductCard`
- Props 篩選：`[price]` 查找有 price prop 的組件
- 正則表達式：`/Product.*/`

### Profiler 面板

用於分析渲染性能：

1. 點擊 **Record** 開始錄製
2. 在頁面上進行操作
3. 點擊 **Stop** 結束
4. 查看每個組件的渲染次數和耗時

**火焰圖顯示**：

```
Commit #1 (32ms)
├── App (2ms)
├── Layout (1ms)
└── ProductList (28ms) ← 渲染慢！
    ├── ProductCard (8ms)
    ├── ProductCard (8ms)
    └── ProductCard (8ms)
```

**識別不必要的渲染**：

勾選 "Record why each component rendered"，可以看到渲染原因：

- **Props changed**：Props 發生變化
- **Hooks changed**：State 或其他 Hook 值變化
- **Parent rendered**：父組件重新渲染導致

### 常用調試場景

**場景 1：Props 沒傳對**

```tsx
// 父組件
<UserCard user={userData} />

// DevTools 中檢查 UserCard 的 props
// 發現 user 是 undefined
// 回溯檢查 userData 的來源
```

**場景 2：State 更新但 UI 不變**

```tsx
// DevTools 中檢查 State 已更新爲新值
// 但組件沒有重新渲染
// 可能原因：直接修改了對象而非創建新引用
```

**場景 3：組件渲染太多次**

```tsx
// Profiler 顯示組件每次父組件更新都重新渲染
// 但 Props 沒有變化
// 解決：使用 React.memo 包裹
```

### 高級功能

**高亮更新**

Settings → General → Highlight updates when components render

開啓後，渲染的組件會閃爍邊框，幫助發現不必要的渲染。

**組件過濾**

Settings → Components → Hide components matching...

可以隱藏不關心的組件（如 Provider、Context）。

**調試 Suspense**

Components 面板會顯示 Suspense 邊界和其 fallback 狀態。

### AI 協作指南

**核心意圖**：用 DevTools 數據幫 AI 定位組件問題。

**有效的描述方式**：

```
ProductCard 組件顯示不正確：

DevTools 顯示的 Props：
- product: {id: 1, name: null, price: 999}

預期 name 應該有值，但實際是 null。
數據來源是 API 返回的 data.products[0]。

請問可能是什麼原因？
```

**關鍵術語**：`Props`、`State`、`Hooks`、`重渲染`、`Profiler`

### 避坑指南

1. **開發模式纔有效**：生產構建的 React 應用信息有限
2. **擴展可能衝突**：其他 DevTools 擴展可能影響 React DevTools
3. **匿名組件難定位**：給組件加上 displayName 便於調試
4. **Context 顯示爲匿名**：建議給 Context 命名

```tsx
// 給 Context 命名
const ThemeContext = createContext(null)
ThemeContext.displayName = 'ThemeContext'
```

### 驗收清單

- [ ] 已安裝 React Developer Tools 擴展
- [ ] 能夠在組件樹中定位目標組件
- [ ] 能夠查看和修改組件的 Props 和 State
- [ ] 能夠使用 Profiler 分析渲染性能
