---
title: "7.2.2 網址該怎麼設計——資源設計：URL 路徑與資源映射"
typora-root-url: ../../public
---

# 7.2.2 資源設計

## 一句話破題

REST 的 R 是 Resource（資源），URL 就是資源的地址——好的 URL 設計讓 API 一目瞭然。

## URL 設計原則

```mermaid
flowchart LR
    Resource["識別資源"] --> Naming["命名規範"]
    Naming --> Hierarchy["層級關係"]
    Hierarchy --> Operations["操作映射"]
```

| 原則 | 說明 | 示例 |
|------|------|------|
| **名詞而非動詞** | URL 表示資源 | `/users` 而非 `/getUsers` |
| **複數形式** | 資源集合用複數 | `/posts` 而非 `/post` |
| **小寫字母** | 統一使用小寫 | `/api/users` 而非 `/api/Users` |
| **連字符分隔** | 多詞用連字符 | `/blog-posts` 而非 `/blogPosts` |

## 基本 CRUD 操作

```typescript
// 資源: 文章 (posts)

// 集合操作
GET    /api/posts          // 獲取文章列表
POST   /api/posts          // 創建文章

// 單個資源操作
GET    /api/posts/:id      // 獲取單篇文章
PUT    /api/posts/:id      // 替換文章
PATCH  /api/posts/:id      // 更新文章部分字段
DELETE /api/posts/:id      // 刪除文章
```

### Next.js 實現

```typescript
// app/api/posts/route.ts - 集合操作
export async function GET(request: NextRequest) {
  const posts = await prisma.post.findMany()
  return NextResponse.json({ data: posts })
}

export async function POST(request: NextRequest) {
  const body = await request.json()
  const post = await prisma.post.create({ data: body })
  return NextResponse.json(post, { status: 201 })
}

// app/api/posts/[id]/route.ts - 單個資源操作
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const post = await prisma.post.findUnique({
    where: { id: params.id },
  })
  
  if (!post) {
    return NextResponse.json(
      { error: { code: 'NOT_FOUND', message: '文章不存在' } },
      { status: 404 }
    )
  }
  
  return NextResponse.json(post)
}
```

## 嵌套資源

```mermaid
flowchart LR
    User["用戶"] --> Posts["文章"]
    Posts --> Comments["評論"]
```

### 設計模式

```typescript
// 用戶的文章
GET    /api/users/:userId/posts
POST   /api/users/:userId/posts

// 文章的評論
GET    /api/posts/:postId/comments
POST   /api/posts/:postId/comments

// 最多嵌套兩層，更深用查詢參數
GET    /api/comments?postId=123&userId=456
```

### 實現示例

```typescript
// app/api/users/[userId]/posts/route.ts
export async function GET(
  request: NextRequest,
  { params }: { params: { userId: string } }
) {
  const posts = await prisma.post.findMany({
    where: { authorId: params.userId },
  })
  return NextResponse.json({ data: posts })
}

export async function POST(
  request: NextRequest,
  { params }: { params: { userId: string } }
) {
  const body = await request.json()
  const post = await prisma.post.create({
    data: {
      ...body,
      authorId: params.userId,
    },
  })
  return NextResponse.json(post, { status: 201 })
}
```

## 非 CRUD 操作

有些操作不是簡單的 CRUD，需要特殊處理：

### 方案一：使用動作資源

```typescript
// 發佈文章
POST   /api/posts/:id/publish

// 取消發佈
POST   /api/posts/:id/unpublish

// 歸檔
POST   /api/posts/:id/archive
```

### 方案二：使用 PATCH 更新狀態

```typescript
// 更新狀態字段
PATCH  /api/posts/:id
{ "status": "published" }
```

### 方案三：批量操作

```typescript
// 批量刪除
POST   /api/posts/batch-delete
{ "ids": ["1", "2", "3"] }

// 批量更新
POST   /api/posts/batch-update
{ "ids": ["1", "2"], "data": { "status": "archived" } }
```

## URL 設計示例

### 電商系統

```typescript
// 商品
GET    /api/products
GET    /api/products/:id
GET    /api/products/:id/reviews

// 購物車
GET    /api/cart
POST   /api/cart/items
DELETE /api/cart/items/:itemId

// 訂單
GET    /api/orders
POST   /api/orders
GET    /api/orders/:id
POST   /api/orders/:id/cancel
POST   /api/orders/:id/pay
```

### 博客系統

```typescript
// 文章
GET    /api/posts
GET    /api/posts/:id
GET    /api/posts/:slug          // 使用 slug 作爲標識

// 分類和標籤
GET    /api/categories
GET    /api/categories/:id/posts

GET    /api/tags
GET    /api/tags/:name/posts     // 標籤關聯的文章

// 評論
GET    /api/posts/:id/comments
POST   /api/posts/:id/comments
```

## 查詢與過濾

```typescript
// 分頁
GET /api/posts?page=2&pageSize=10

// 過濾
GET /api/posts?status=published&authorId=123

// 排序
GET /api/posts?sort=-createdAt

// 搜索
GET /api/posts?search=typescript

// 字段選擇
GET /api/posts?fields=id,title,createdAt

// 組合使用
GET /api/posts?status=published&sort=-createdAt&page=1&pageSize=10
```

## 覺知：常見錯誤

### 1. 動詞放入 URL

```
❌ GET  /api/getUsers
❌ POST /api/createPost
❌ POST /api/deleteUser/123

✅ GET    /api/users
✅ POST   /api/posts
✅ DELETE /api/users/123
```

### 2. 單複數混用

```
❌ GET /api/user          // 應該是複數
❌ GET /api/users/1/post  // 嵌套也應該是複數

✅ GET /api/users
✅ GET /api/users/1/posts
```

### 3. 過深的嵌套

```
❌ /api/users/1/posts/2/comments/3/replies/4
   太深了，難以維護

✅ /api/replies/4
✅ /api/comments?postId=2&replyTo=3
```

### 4. 使用 ID 以外的無意義標識

```
❌ /api/posts/abc123xyz   // 無意義的標識

✅ /api/posts/123         // 數據庫 ID
✅ /api/posts/my-first-post  // 有意義的 slug
```

## 本節小結

| 要點 | 說明 |
|------|------|
| **名詞複數** | `/users` 而非 `/getUser` |
| **HTTP 方法** | 用方法表達操作意圖 |
| **嵌套兩層** | 最多嵌套兩層，更深用查詢 |
| **非 CRUD** | 使用動作資源或狀態更新 |
