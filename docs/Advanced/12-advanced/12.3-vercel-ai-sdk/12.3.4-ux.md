---
title: "12.3.4 用戶體驗優化——加載狀態與錯誤處理：優雅的 AI 交互設計"
typora-root-url: ../../public
---

# 12.3.4 用戶體驗優化——加載狀態與錯誤處理：優雅的 AI 交互設計

### 一句話破題

AI 應用的用戶體驗不僅取決於模型能力，更取決於如何處理加載、錯誤和邊緣情況——這是區分"能用"和"好用"的關鍵。

### 核心價值

優秀的 AI 應用需要處理以下場景：

1. **加載狀態**：讓用戶知道 AI 正在思考
2. **流式顯示**：逐字顯示，而非突然出現
3. **錯誤恢復**：出錯時提供重試選項
4. **取消操作**：允許用戶中途停止
5. **空狀態**：初始狀態的引導

### 加載狀態設計

```tsx
function LoadingIndicator() {
  return (
    <div className="flex items-center gap-2 text-gray-500">
      <div className="flex gap-1">
        <span className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
        <span className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
        <span className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
      </div>
      <span>AI 正在思考...</span>
    </div>
  );
}

function ChatUI() {
  const { messages, isLoading, ... } = useChat();

  return (
    <div>
      {messages.map((m) => (
        <MessageBubble key={m.id} message={m} />
      ))}
      
      {isLoading && <LoadingIndicator />}
    </div>
  );
}
```

### 打字機效果優化

默認的流式輸出已經是逐字顯示，但可以進一步優化：

```tsx
function StreamingMessage({ content }: { content: string }) {
  return (
    <div className="relative">
      <span>{content}</span>
      <span className="inline-block w-2 h-4 bg-gray-800 animate-pulse ml-1" />
    </div>
  );
}
```

### 錯誤處理與重試

```tsx
function ChatWithErrorHandling() {
  const { messages, error, reload, isLoading } = useChat({
    onError: (error) => {
      // 可以接入錯誤監控服務
      console.error('Chat error:', error);
    },
  });

  if (error) {
    return (
      <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
        <div className="flex items-center gap-2 text-red-700">
          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
          </svg>
          <span>出錯了：{error.message}</span>
        </div>
        <button
          onClick={() => reload()}
          className="mt-2 px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"
        >
          重試
        </button>
      </div>
    );
  }

  // ... 正常渲染
}
```

### 取消生成

```tsx
function ChatWithStop() {
  const { isLoading, stop, handleSubmit, ... } = useChat();

  return (
    <form onSubmit={handleSubmit}>
      {/* ... 輸入框 */}
      
      {isLoading ? (
        <button
          type="button"
          onClick={stop}
          className="px-4 py-2 bg-red-500 text-white rounded"
        >
          停止生成
        </button>
      ) : (
        <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded">
          發送
        </button>
      )}
    </form>
  );
}
```

### 空狀態引導

```tsx
function EmptyState() {
  const suggestions = [
    '幫我寫一段自我介紹',
    '解釋什麼是 React Hooks',
    '給我講個笑話',
  ];

  return (
    <div className="flex flex-col items-center justify-center h-full text-center p-8">
      <h2 className="text-2xl font-bold mb-4">有什麼可以幫你的？</h2>
      <p className="text-gray-500 mb-6">試試以下問題：</p>
      <div className="flex flex-wrap gap-2 justify-center">
        {suggestions.map((s) => (
          <button
            key={s}
            onClick={() => append({ role: 'user', content: s })}
            className="px-4 py-2 bg-gray-100 rounded-full hover:bg-gray-200"
          >
            {s}
          </button>
        ))}
      </div>
    </div>
  );
}

function Chat() {
  const { messages, append, ... } = useChat();

  return (
    <div>
      {messages.length === 0 ? (
        <EmptyState />
      ) : (
        // ... 消息列表
      )}
    </div>
  );
}
```

### AI 協作指南

- **核心意圖**：讓 AI 幫你設計完善的交互狀態。
- **需求定義公式**：`"請幫我實現一個 AI 聊天界面的完整狀態處理，包括加載動畫、錯誤提示、重試按鈕和停止生成功能。"`
- **關鍵術語**：`isLoading`、`error`、`reload`、`stop`、`空狀態 (empty state)`

### 避坑指南

- **加載狀態要有視覺反饋**：不要讓用戶猜測是否在工作。
- **錯誤信息要可理解**：將技術錯誤轉換爲用戶友好的提示。
- **提供逃生出口**：用戶應該能夠取消長時間運行的操作。
