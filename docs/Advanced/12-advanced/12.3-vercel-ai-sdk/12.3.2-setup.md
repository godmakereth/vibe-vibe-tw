---
title: "12.3.2 官方工具包——Vercel AI SDK：安裝配置與基礎使用"
typora-root-url: ../../public
---

# 12.3.2 官方工具包——Vercel AI SDK：安裝配置與基礎使用

### 一句話破題

Vercel AI SDK 提供了統一的接口來調用各種 AI 模型，幾行代碼就能搭建起一個具備流式對話能力的 AI 應用。

### 快速上手

#### 1. 安裝依賴

```bash
pnpm add ai @ai-sdk/openai
```

SDK 採用模塊化設計，不同的模型提供商需要安裝對應的包：

| 提供商 | 包名 |
|--------|------|
| OpenAI | `@ai-sdk/openai` |
| Anthropic | `@ai-sdk/anthropic` |
| Google | `@ai-sdk/google` |
| Azure | `@ai-sdk/azure` |

#### 2. 配置環境變量

```env
# .env.local
OPENAI_API_KEY=sk-xxxxxxxxxxxxx
```

#### 3. 創建 API 路由

```typescript
// app/api/chat/route.ts
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';

export async function POST(req: Request) {
  const { messages } = await req.json();

  const result = streamText({
    model: openai('gpt-4o'),
    messages,
  });

  return result.toDataStreamResponse();
}
```

#### 4. 前端調用

```tsx
'use client';

import { useChat } from 'ai/react';

export default function Chat() {
  const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat();

  return (
    <div>
      {messages.map((m) => (
        <div key={m.id}>
          <strong>{m.role}:</strong> {m.content}
        </div>
      ))}

      <form onSubmit={handleSubmit}>
        <input
          value={input}
          onChange={handleInputChange}
          placeholder="輸入消息..."
          disabled={isLoading}
        />
        <button type="submit" disabled={isLoading}>
          發送
        </button>
      </form>
    </div>
  );
}
```

### 核心 API 概覽

| API | 用途 | 返回類型 |
|-----|------|----------|
| `streamText` | 流式文本生成 | `StreamTextResult` |
| `generateText` | 一次性文本生成 | `GenerateTextResult` |
| `streamObject` | 流式結構化輸出 | `StreamObjectResult` |
| `generateObject` | 一次性結構化輸出 | `GenerateObjectResult` |

### 切換模型提供商

SDK 的優勢在於統一接口，切換模型只需更改一行代碼：

```typescript
import { openai } from '@ai-sdk/openai';
import { anthropic } from '@ai-sdk/anthropic';
import { google } from '@ai-sdk/google';

// 使用 OpenAI
const result = streamText({
  model: openai('gpt-4o'),
  messages,
});

// 使用 Anthropic
const result = streamText({
  model: anthropic('claude-3-5-sonnet-20241022'),
  messages,
});

// 使用 Google
const result = streamText({
  model: google('gemini-1.5-pro'),
  messages,
});
```

### AI 協作指南

- **核心意圖**：讓 AI 幫你快速搭建 AI 對話功能。
- **需求定義公式**：`"請幫我在 Next.js 項目中集成 Vercel AI SDK，實現一個基礎的聊天界面，使用 OpenAI 的 gpt-4o 模型。"`
- **關鍵術語**：`streamText`、`useChat`、`ai/react`、`toDataStreamResponse`

### 避坑指南

- **API Key 不要暴露到前端**：環境變量只在服務端可用，這是設計使然。
- **注意 Token 限制**：不同模型的上下文窗口大小不同。
- **處理速率限制**：API 調用可能會遇到速率限制，需要添加重試邏輯。
