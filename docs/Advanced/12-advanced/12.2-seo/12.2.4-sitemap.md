---
title: "12.2.4 給爬蟲畫地圖——站點地圖：XML Sitemap 生成與提交"
typora-root-url: ../../public
---

# 12.2.4 給爬蟲畫地圖——站點地圖：XML Sitemap 生成與提交

### 一句話破題

站點地圖是一份告訴搜索引擎"我的網站有哪些頁面、哪些更重要、多久更新一次"的清單，幫助爬蟲更高效地發現和抓取你的內容。

### 核心價值

站點地圖對 SEO 的作用：

1. **加速收錄**：主動告知搜索引擎新頁面的存在
2. **優先級指引**：告訴爬蟲哪些頁面更重要
3. **更新頻率**：幫助爬蟲決定多久來一次
4. **覆蓋盲區**：確保沒有內鏈指向的"孤島頁面"也能被發現

### 本質還原：Sitemap 的結構

```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://example.com/</loc>
    <lastmod>2024-01-15</lastmod>
    <changefreq>daily</changefreq>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>https://example.com/blog/nextjs-tutorial</loc>
    <lastmod>2024-01-10</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.8</priority>
  </url>
</urlset>
```

| 字段 | 含義 | 建議值 |
|------|------|--------|
| `loc` | 頁面 URL（必填） | 使用絕對路徑 |
| `lastmod` | 最後修改時間 | ISO 8601 格式 |
| `changefreq` | 更新頻率 | always/hourly/daily/weekly/monthly/yearly/never |
| `priority` | 相對優先級 | 0.0-1.0，首頁通常爲 1.0 |

### Next.js 中生成站點地圖

#### 方法一：靜態站點地圖

```tsx
// app/sitemap.ts
import { MetadataRoute } from 'next';

export default function sitemap(): MetadataRoute.Sitemap {
  return [
    {
      url: 'https://example.com',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    {
      url: 'https://example.com/about',
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.8,
    },
  ];
}
```

#### 方法二：動態站點地圖

```tsx
// app/sitemap.ts
import { MetadataRoute } from 'next';
import { getAllPosts } from '@/lib/posts';

export default async function sitemap(): MetadataRoute.Sitemap {
  const posts = await getAllPosts();
  
  const postUrls = posts.map((post) => ({
    url: `https://example.com/blog/${post.slug}`,
    lastModified: new Date(post.updatedAt),
    changeFrequency: 'weekly' as const,
    priority: 0.7,
  }));

  return [
    {
      url: 'https://example.com',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    ...postUrls,
  ];
}
```

訪問 `/sitemap.xml` 即可看到生成的站點地圖。

### 大型網站：Sitemap Index

當頁面數量超過 50,000 或文件大小超過 50MB 時，需要使用站點地圖索引：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>https://example.com/sitemap-posts.xml</loc>
    <lastmod>2024-01-15</lastmod>
  </sitemap>
  <sitemap>
    <loc>https://example.com/sitemap-products.xml</loc>
    <lastmod>2024-01-14</lastmod>
  </sitemap>
</sitemapindex>
```

### 提交站點地圖

1. **在 robots.txt 中聲明**：
```txt
Sitemap: https://example.com/sitemap.xml
```

2. **通過站長工具提交**：
   - Google Search Console
   - 百度站長平臺
   - Bing Webmaster Tools

### AI 協作指南

- **核心意圖**：讓 AI 幫你生成站點地圖配置或解決站點地圖問題。
- **需求定義公式**：`"請幫我在 Next.js 中實現動態站點地圖，需要包含所有博客文章和產品頁面，使用數據庫中的更新時間作爲 lastmod。"`
- **關鍵術語**：`sitemap.xml`、`MetadataRoute.Sitemap`、`Sitemap Index`、`lastmod`

### 避坑指南

- **只包含可索引頁面**：不要把 404 頁面、登錄後頁面放入站點地圖。
- **保持 lastmod 準確**：不要把所有頁面的 lastmod 設爲當前時間，這會降低信息的可信度。
- **定期更新**：站點地圖應該隨着內容更新而更新。
- **監控爬取狀態**：在站長工具中檢查站點地圖是否被正確讀取。
