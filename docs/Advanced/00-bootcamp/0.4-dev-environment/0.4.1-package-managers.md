---
title: "0.4.1 工具箱該選哪一個——包管理器選擇：npm vs pnpm vs yarn"
typora-root-url: ../../public
---

# 0.4.1 工具箱該選哪一個——包管理器選擇：npm vs pnpm vs yarn

## 原理與本質：它們到底在做什麼

包管理器的本質是三件事：**解析依賴樹**、**下載並緩存包**、**把依賴鏈接到項目的 `node_modules`**。差異在於“如何存儲”和“如何鏈接”。

## 性能與磁盤空間對比（工程視角）

```mermaid
flowchart TB
    subgraph sgnpm ["npm"]
        NCache["每項目獨立緩存"];
        NLink["扁平安裝, 容易重複"];
    end
    subgraph sgpnpm ["pnpm"]
        PStore["全局內容尋址存儲 (store)"];
        PLink["硬鏈接/符號鏈接, 複用依賴"];
    end
    subgraph sgyarn ["yarn"]
        YClassic["經典模式, 類似 npm"];
        YBerry["Plug'n'Play, 無 node_modules"];
    end
    NCache --> NLink
    PStore --> PLink
    YClassic --> YBerry
```

- `pnpm`：通過**全局內容尋址存儲**複用依賴，磁盤佔用更低，安裝更快，鎖文件更穩定。
- `yarn berry`：Plug'n'Play 模式不生成 `node_modules`，啓動速度快，但生態適配需要額外注意。
- `npm`：默認行爲直觀，生態支持最好，但容易造成重複下載與磁盤膨脹。

## SemVer 語義化版本與版本範圍

- 語義化版本：`主.次.修訂`（`major.minor.patch`）。
- 版本範圍：
  - `^1.2.3`：允許更新到 `<2.0.0`（保留主版本，升級次/修訂）。
  - `~1.2.3`：允許更新到 `<1.3.0`（保留主/次版本，升級修訂）。
  - 精確鎖定：`1.2.3`。

## 破壞性更新識別與應對

- 識別：`major` 版本變更通常意味着不兼容，查看 Release Notes 與 Changelog。
- 應對：
  - 關鍵依賴使用謹慎範圍（敏感場景用 `~` 或固定版本）。
  - 升級前跑測試與構建，觀察 `npm outdated`/`pnpm outdated`。
  - 鎖文件統一併審查差異，避免團隊成員鎖文件漂移。

## Windows PowerShell 常用命令

- `npm`：
  - `npm config get registry`
  - `npm config set registry https://registry.npmmirror.com`
  - `npm cache clean --force`
- `pnpm`：
  - `pnpm config set registry https://registry.npmmirror.com`
  - `pnpm store path`
  - `pnpm store prune`
- `yarn`：
  - `yarn config get registry`
  - `yarn config set registry https://registry.npmmirror.com`

## AI 協作指南

- 核心意圖：讓 AI 幫你“選擇並遷移包管理器”，並輸出**可執行命令**與**風險提示**。
- 需求定義公式：
  - “將項目從 `npm` 遷移到 `pnpm`，請輸出清理緩存、重建鎖文件、驗證安裝速度與磁盤佔用的命令清單。”
- 關鍵術語：`registry`, `lockfile`, `store`, `Plug'n'Play`, `outdated`。

## 決策建議

- 新項目優先選擇 `pnpm`（性能與磁盤佔用優秀）。
- 需要 PnP 或對 `node_modules` 有強訴求的項目考慮 `yarn berry`。
- 生態兼容和團隊習慣優先時，選擇 `pnpm` 並規範版本範圍與緩存策略。
