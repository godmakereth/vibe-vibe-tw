---
title: "0.4.2 爲什麼我的 Node 版本不對——Node.js 版本管理與 nvm"
typora-root-url: ../../public
---

# 0.4.2 爲什麼我的 Node 版本不對——Node.js 版本管理與 nvm

## 一句話破題

不同項目需要不同 Node 版本。**用 nvm 管理 Node**，用 `.nvmrc` 鎖定項目版本，避免“在我機器上能跑”的尷尬。

## nvm 安裝與配置：Windows/macOS/Linux

- Windows：使用 `nvm-windows`（Corey Butler 版）。
  - 安裝後在 PowerShell 驗證：`Get-Command nvm`
  - 常用命令：`nvm list`、`nvm install 18.19.0`、`nvm use 18.19.0`
- macOS/Linux：使用 `nvm`（Shell 腳本版）。
  - 常用命令相同：`nvm ls`、`nvm install 20`、`nvm use 20`

## Node.js 版本選擇策略：LTS vs Current

- 開發與生產優先選擇 **LTS**（長期支持），穩定且生態兼容好。
- 新特性探索或實驗環境可用 **Current**，但不建議用於生產。

## 項目級版本鎖定：.nvmrc

- 在項目根目錄創建 `.nvmrc`，內容爲目標版本：

```
18.19.0
```

- Windows PowerShell 下讀取並切換：

```powershell
$version = Get-Content .nvmrc | Select-Object -First 1
nvm use $version
node -v
```

## 環境變量與配置管理

- 當前會話設置：`$env:NODE_ENV = 'development'`
- 持久化設置：`setx NODE_ENV production`
- 自定義變量：`$env:API_BASE = 'https://api.example.com'`

## 包管理器配置與優化（配合 nvm 使用）

- registry：
  - `npm config set registry https://registry.npmmirror.com`
  - `pnpm config set registry https://registry.npmmirror.com`
- 緩存：
  - `npm cache verify`
  - `pnpm store prune`

## AI 協作指南

- 核心意圖：讓 AI 幫你**規範版本**與**生成切換腳本**。
- 需求定義公式：
  - “在 Windows PowerShell 下，檢測 `.nvmrc` 並自動切換到對應版本，如果未安裝則自動安裝。”
- 關鍵術語：`nvm-windows`, `.nvmrc`, `LTS`, `NODE_ENV`, `registry`, `cache`。

## 避坑指南

- Windows 下的 `nvm-windows` 與 Unix 的 `nvm` 不同；腳本互換需注意兼容。
- 全局 Node 與項目 `.nvmrc` 不一致會導致依賴編譯失敗（如 `node-gyp`）。
- 切換 Node 版本後，建議清理並重裝依賴，確保二進制綁定一致。
