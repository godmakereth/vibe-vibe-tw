---
title: "0.7.4 程序關了數據還在嗎——數據卷：持久化存儲與數據管理"
typora-root-url: ../../public
---

# 0.7.4 程序關了數據還在嗎——數據卷

## 一句話破題

容器數據是臨時的，關了就沒了。**數據卷 (Volumes)** 爲數據保留“家”，讓服務重啓後數據仍在。

## 卷類型

- 命名卷：由 Docker 管理，跨容器共享，跨重啓持久。
- 綁定掛載：把宿主機目錄掛到容器內，適合開發或與宿主機文件交互。

## 命名卷示例

```powershell
docker volume create pgdata
docker run -d --name db -p 5432:5432 -v pgdata:/var/lib/postgresql/data postgres:15-alpine
```

## 綁定掛載示例（Windows 路徑）

```powershell
docker run -d --name app -p 3000:3000 -v "D:\\data:/app/data" myapp:latest
```

## Compose：多服務編排

`docker-compose.yml`

```yaml
version: '3.9'
services:
  db:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=secret
    volumes:
      - pgdata:/var/lib/postgresql/data
  app:
    image: myapp:latest
    ports:
      - "3000:3000"
    environment:
      - DB_URL=postgres://postgres:secret@db:5432/postgres
    depends_on:
      - db
volumes:
  pgdata:
```

啓動：`docker compose up -d`，查看：`docker compose ps`。

## 可視化

```mermaid
flowchart LR
    V[命名卷 pgdata] --> DB[容器 db]
    DB --> APP[容器 app]
    APP --> Host[宿主機端口 3000]
```

## 覺知：持久化與可移植

- 數據不要寫進容器層；統一寫入卷或綁定掛載。
- 在 Windows 下綁定路徑時使用絕對路徑；生產環境優先命名卷。

## AI 協作指南

- 核心意圖：讓 AI 生成“帶持久化的 Compose 文件”。
- 需求定義公式：
  - “生成一個包含 `app` 和 `db` 的 Compose，`db` 使用命名卷持久化數據，`app` 通過容器名連接數據庫。”
