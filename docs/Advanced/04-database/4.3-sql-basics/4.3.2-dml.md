---
title: "4.3.2 如何操作表裏的數據——DML 數據操作：INSERT/UPDATE/DELETE/SELECT"
typora-root-url: ../../public
---

# 4.3.2 如何操作表裏的數據——DML 數據操作：INSERT/UPDATE/DELETE/SELECT

### 一句話破題

DML 是用來操作數據的語言——就是我們熟悉的 CRUD，只不過用 SQL 寫出來。

### INSERT：插入數據

**插入單條**：
```sql
INSERT INTO users (id, email, name) 
VALUES ('uuid-1', 'user@example.com', '張三');
```

**插入多條**：
```sql
INSERT INTO users (id, email, name) VALUES 
  ('uuid-1', 'user1@example.com', '用戶1'),
  ('uuid-2', 'user2@example.com', '用戶2');
```

**Prisma 對照**：
```typescript
// 單條
await prisma.user.create({
  data: { email: 'user@example.com', name: '張三' }
})

// 多條
await prisma.user.createMany({
  data: [
    { email: 'user1@example.com', name: '用戶1' },
    { email: 'user2@example.com', name: '用戶2' }
  ]
})
```

### SELECT：查詢數據

**基礎查詢**：
```sql
-- 查詢所有列
SELECT * FROM users;

-- 查詢指定列
SELECT id, name FROM users;

-- 條件查詢
SELECT * FROM users WHERE email = 'user@example.com';
```

**常用條件**：
```sql
-- 模糊匹配
SELECT * FROM users WHERE name LIKE '張%';

-- 範圍查詢
SELECT * FROM posts WHERE created_at > '2024-01-01';

-- 多條件
SELECT * FROM users WHERE role = 'ADMIN' AND status = 'ACTIVE';

-- IN 查詢
SELECT * FROM users WHERE id IN ('uuid-1', 'uuid-2');
```

**排序和分頁**：
```sql
-- 排序
SELECT * FROM posts ORDER BY created_at DESC;

-- 分頁（PostgreSQL）
SELECT * FROM posts LIMIT 10 OFFSET 0;
```

**Prisma 對照**：
```typescript
await prisma.user.findMany({
  where: { 
    name: { contains: '張' },
    role: 'ADMIN'
  },
  orderBy: { createdAt: 'desc' },
  take: 10,
  skip: 0
})
```

### UPDATE：更新數據

**更新單條/多條**：
```sql
-- 更新指定記錄
UPDATE users SET name = '李四' WHERE id = 'uuid-1';

-- 批量更新
UPDATE users SET status = 'INACTIVE' WHERE last_login < '2024-01-01';
```

**Prisma 對照**：
```typescript
// 單條
await prisma.user.update({
  where: { id: 'uuid-1' },
  data: { name: '李四' }
})

// 批量
await prisma.user.updateMany({
  where: { lastLogin: { lt: new Date('2024-01-01') } },
  data: { status: 'INACTIVE' }
})
```

::: warning 注意
UPDATE 不帶 WHERE 條件會更新所有記錄！
```sql
-- 危險！會更新所有用戶
UPDATE users SET status = 'DELETED';
```
:::

### DELETE：刪除數據

```sql
-- 刪除指定記錄
DELETE FROM users WHERE id = 'uuid-1';

-- 批量刪除
DELETE FROM users WHERE status = 'DELETED';
```

**Prisma 對照**：
```typescript
await prisma.user.delete({ where: { id: 'uuid-1' } })
await prisma.user.deleteMany({ where: { status: 'DELETED' } })
```

::: danger 警告
DELETE 不帶 WHERE 條件會刪除所有數據！
```sql
-- 危險！會刪除所有用戶
DELETE FROM users;
```
:::

### SQL vs Prisma 速查表

| 操作 | SQL | Prisma |
|------|-----|--------|
| 插入 | `INSERT INTO ... VALUES` | `create()` |
| 查詢全部 | `SELECT * FROM` | `findMany()` |
| 條件查詢 | `WHERE column = value` | `where: { column: value }` |
| 模糊查詢 | `LIKE '%keyword%'` | `contains: 'keyword'` |
| 排序 | `ORDER BY column DESC` | `orderBy: { column: 'desc' }` |
| 分頁 | `LIMIT 10 OFFSET 0` | `take: 10, skip: 0` |
| 更新 | `UPDATE ... SET ... WHERE` | `update()` |
| 刪除 | `DELETE FROM ... WHERE` | `delete()` |

### 本節小結

- DML 用於操作數據（INSERT/SELECT/UPDATE/DELETE）
- Prisma 提供類型安全的 DML 封裝
- UPDATE 和 DELETE 一定要帶 WHERE 條件
- 理解 SQL 有助於調試 Prisma 生成的查詢
