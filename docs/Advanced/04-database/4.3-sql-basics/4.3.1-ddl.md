---
title: "4.3.1 如何創建一張表——DDL 數據定義：CREATE/ALTER/DROP 語句"
typora-root-url: ../../public
---

# 4.3.1 如何創建一張表——DDL 數據定義：CREATE/ALTER/DROP 語句

### 一句話破題

DDL 是用來定義數據庫"骨架"的語言——創建表、修改結構、刪除表都靠它。

### DDL 三大操作

| 操作 | 說明 | 危險等級 |
|------|------|----------|
| **CREATE** | 創建表、索引、視圖 | 低 |
| **ALTER** | 修改表結構 | 中 |
| **DROP** | 刪除表、索引 | 高（數據會丟失！）|

### CREATE：創建表

**SQL 語法**：
```sql
CREATE TABLE users (
  id         VARCHAR(36) PRIMARY KEY,
  email      VARCHAR(255) NOT NULL UNIQUE,
  name       VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**對應的 Prisma Schema**：
```prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
}
```

**常用數據類型對照**：

| SQL 類型 | Prisma 類型 | 說明 |
|----------|-------------|------|
| VARCHAR(n) | String | 變長字符串 |
| TEXT | String | 長文本 |
| INTEGER | Int | 整數 |
| BIGINT | BigInt | 大整數 |
| BOOLEAN | Boolean | 布爾值 |
| TIMESTAMP | DateTime | 時間戳 |
| DECIMAL | Decimal | 精確小數 |
| JSON | Json | JSON 數據 |

### ALTER：修改表結構

**添加列**：
```sql
ALTER TABLE users ADD COLUMN phone VARCHAR(20);
```

**修改列類型**：
```sql
ALTER TABLE users ALTER COLUMN name TYPE VARCHAR(200);
```

**刪除列**：
```sql
ALTER TABLE users DROP COLUMN phone;
```

**添加索引**：
```sql
CREATE INDEX idx_users_email ON users(email);
```

**在 Prisma 中**：修改 schema.prisma 後執行 `npx prisma migrate dev`

### DROP：刪除表

```sql
-- 刪除表（數據會全部丟失！）
DROP TABLE users;

-- 如果表存在才刪除（避免報錯）
DROP TABLE IF EXISTS users;
```

::: danger 警告
DROP TABLE 會**永久刪除**所有數據，無法恢復！生產環境慎用。
:::

### Prisma 遷移與 DDL

Prisma 通過遷移（Migration）管理 DDL：

```bash
# 1. 修改 schema.prisma
# 2. 生成遷移文件（包含 SQL）
npx prisma migrate dev --name add_phone_field

# 3. 查看生成的 SQL
cat prisma/migrations/xxx_add_phone_field/migration.sql
```

生成的遷移文件示例：
```sql
-- migration.sql
ALTER TABLE "User" ADD COLUMN "phone" TEXT;
```

### 爲什麼要了解 DDL？

1. **調試遷移問題**：遷移失敗時需要看懂 SQL 報錯
2. **手動修復數據**：有時需要直接執行 SQL
3. **性能優化**：理解索引創建語法

### 本節小結

- DDL 用於定義數據庫結構（CREATE/ALTER/DROP）
- Prisma 通過遷移自動生成 DDL
- DROP 是危險操作，會永久刪除數據
- 瞭解 DDL 有助於調試和優化
