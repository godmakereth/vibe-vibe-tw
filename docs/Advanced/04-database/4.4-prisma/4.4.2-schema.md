---
title: "4.4.2 Schema 文件結構：generator/datasource/model"
typora-root-url: ../../public
---

# 4.4.2 Schema 文件結構：generator/datasource/model

### 一句話破題

schema.prisma 是 Prisma 的核心配置文件——它定義了數據庫連接、代碼生成器和數據模型。

### Schema 文件三大塊

```prisma
// 1. 生成器配置（Generator）
generator client {
  provider = "prisma-client-js"
}

// 2. 數據源配置（Datasource）
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 3. 數據模型（Model）
model User {
  id    String @id @default(cuid())
  email String @unique
  name  String?
  posts Post[]
}
```

### Generator：生成器配置

```prisma
generator client {
  provider        = "prisma-client-js"  // 生成 JS/TS 客戶端
  previewFeatures = ["fullTextSearch"]   // 啓用預覽功能
}
```

| 選項 | 說明 |
|------|------|
| `provider` | 生成器類型，通常是 `prisma-client-js` |
| `previewFeatures` | 啓用實驗性功能 |
| `output` | 輸出路徑（通常不需要修改） |

### Datasource：數據源配置

```prisma
datasource db {
  provider = "postgresql"        // 數據庫類型
  url      = env("DATABASE_URL") // 從環境變量讀取連接字符串
}
```

**支持的數據庫**：

| provider | 數據庫 |
|----------|--------|
| `postgresql` | PostgreSQL |
| `mysql` | MySQL |
| `sqlite` | SQLite |
| `sqlserver` | SQL Server |
| `mongodb` | MongoDB |

### Model：數據模型

```prisma
model User {
  // 字段定義
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // 關係定義
  posts     Post[]
  profile   Profile?
}

// 枚舉
enum Role {
  USER
  ADMIN
}
```

### 常用字段修飾符

| 修飾符 | 作用 | 示例 |
|--------|------|------|
| `@id` | 主鍵 | `id String @id` |
| `@unique` | 唯一約束 | `email String @unique` |
| `@default()` | 默認值 | `@default(now())` |
| `@updatedAt` | 自動更新時間 | `updatedAt DateTime @updatedAt` |
| `@relation` | 定義關係 | `@relation(fields: [userId], references: [id])` |
| `@map` | 映射數據庫字段名 | `@map("user_id")` |
| `@@index` | 創建索引 | `@@index([email])` |
| `@@unique` | 複合唯一約束 | `@@unique([userId, teamId])` |

### 字段類型速查

| Prisma 類型 | TypeScript 類型 | 說明 |
|-------------|-----------------|------|
| `String` | `string` | 字符串 |
| `Int` | `number` | 整數 |
| `Float` | `number` | 浮點數 |
| `Boolean` | `boolean` | 布爾值 |
| `DateTime` | `Date` | 日期時間 |
| `Json` | `JsonValue` | JSON 數據 |
| `Decimal` | `Decimal` | 精確小數 |

**可選字段**：類型後加 `?`
```prisma
name String?  // 可以爲 null
```

**數組字段**：類型後加 `[]`
```prisma
tags String[]  // 字符串數組
```

### 本節小結

- schema.prisma 包含三部分：generator、datasource、model
- generator 配置代碼生成，datasource 配置數據庫連接
- model 定義數據結構和關係
- 使用修飾符（@id, @unique 等）定義約束
