---
title: "9.5.2 代碼風格統一了嗎——代碼規範：ESLint/Prettier 自動檢查"
typora-root-url: ../../public
---

# 9.5.2 代碼風格統一了嗎——代碼規範：ESLint/Prettier 自動檢查

**代碼規範不是個人偏好——團隊統一的代碼風格能減少 Code Review 中的摩擦。**

## ESLint vs Prettier

```mermaid
graph LR
    A[代碼檢查] --> B[ESLint]
    A --> C[Prettier]
    
    B --> D[代碼質量]
    B --> E[潛在 Bug]
    B --> F[最佳實踐]
    
    C --> G[代碼格式]
    C --> H[縮進/換行]
    C --> I[引號/分號]
```

## ESLint 配置

```javascript
// eslint.config.js (ESLint 9 Flat Config)
import js from '@eslint/js';
import typescript from '@typescript-eslint/eslint-plugin';
import parser from '@typescript-eslint/parser';
import react from 'eslint-plugin-react';
import reactHooks from 'eslint-plugin-react-hooks';
import prettier from 'eslint-config-prettier';

export default [
  js.configs.recommended,
  {
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      parser,
      parserOptions: {
        ecmaVersion: 'latest',
        sourceType: 'module',
        ecmaFeatures: { jsx: true },
      },
    },
    plugins: {
      '@typescript-eslint': typescript,
      react,
      'react-hooks': reactHooks,
    },
    rules: {
      // TypeScript 規則
      '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
      '@typescript-eslint/no-explicit-any': 'warn',
      '@typescript-eslint/explicit-function-return-type': 'off',
      
      // React 規則
      'react/react-in-jsx-scope': 'off',
      'react-hooks/rules-of-hooks': 'error',
      'react-hooks/exhaustive-deps': 'warn',
      
      // 通用規則
      'no-console': ['warn', { allow: ['warn', 'error'] }],
      'prefer-const': 'error',
    },
  },
  prettier,
];
```

## Prettier 配置

```json
// .prettierrc
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

```
# .prettierignore
node_modules
.next
dist
coverage
*.min.js
```

## CI 配置

```yaml
# .github/workflows/ci.yml
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - run: npm ci
      
      - name: ESLint
        run: npm run lint
      
      - name: Prettier check
        run: npm run format:check
```

## package.json 腳本

```json
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx --max-warnings 0",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check ."
  }
}
```

## 常見 Lint 錯誤

### 1. 未使用的變量

```typescript
// ❌ 錯誤
const unused = 'hello';
function greet(name: string, age: number) {
  return `Hello, ${name}`;
}

// ✅ 正確
function greet(name: string, _age: number) {
  return `Hello, ${name}`;
}
```

### 2. React Hooks 依賴

```typescript
// ❌ 警告：缺少依賴
useEffect(() => {
  fetchUser(userId);
}, []); // 缺少 userId 依賴

// ✅ 正確
useEffect(() => {
  fetchUser(userId);
}, [userId]);
```

### 3. console.log 殘留

```typescript
// ❌ 警告
console.log('調試信息');

// ✅ 使用 logger
logger.debug('調試信息');
```

## Pre-commit 自動修復

```bash
npm install -D husky lint-staged
npx husky init
```

```json
// package.json
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yml}": [
      "prettier --write"
    ]
  }
}
```

```bash
# .husky/pre-commit
npx lint-staged
```

## 自定義規則

```javascript
// eslint.config.js
{
  rules: {
    // 禁止特定導入
    'no-restricted-imports': ['error', {
      patterns: [{
        group: ['@/lib/prisma'],
        importNames: ['prisma'],
        message: '請使用 getPrisma() 獲取 Prisma 實例',
      }],
    }],
    
    // 強制命名規範
    '@typescript-eslint/naming-convention': [
      'error',
      { selector: 'interface', format: ['PascalCase'] },
      { selector: 'typeAlias', format: ['PascalCase'] },
      { selector: 'enum', format: ['PascalCase'] },
    ],
  },
}
```

## 本節小結

ESLint 檢查代碼質量，Prettier 統一代碼格式。在 CI 中運行 `--max-warnings 0` 確保零警告，使用 lint-staged 在提交前自動修復。統一的代碼風格讓 Code Review 更專注於邏輯而非格式。
