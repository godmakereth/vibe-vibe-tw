---
title: "2.6.1 Supabase 能幫你做什麼——Supabase 服務概覽：數據庫/存儲/認證一體化"
typora-root-url: ../../public
---

# 2.6.1 Supabase 服務概覽

## 一句話破題

Supabase 把 PostgreSQL 數據庫、用戶認證、文件存儲、即時訂閱打包成一個開箱即用的 BaaS 平臺——你只需要寫前端代碼，後端它全包了。

## 核心服務詳解

### 1. Database：PostgreSQL 數據庫

```typescript
// 直接在客戶端查詢數據庫
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)

// 查詢
const { data, error } = await supabase
  .from('posts')
  .select('*, author:users(*)')
  .eq('status', 'published')
  .order('created_at', { ascending: false })

// 插入
const { data, error } = await supabase
  .from('posts')
  .insert({ title: 'Hello', content: 'World' })
  .select()
```

**特點**：
- 完整的 PostgreSQL，支持所有 SQL 特性
- 內置 Row Level Security（行級安全）
- 自動生成 REST API 和 GraphQL API
- 可視化數據庫管理界面

### 2. Auth：用戶認證

```typescript
// 郵箱密碼登錄
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password',
})

// OAuth 登錄（Google/GitHub 等）
const { data, error } = await supabase.auth.signInWithOAuth({
  provider: 'google',
})

// 獲取當前用戶
const { data: { user } } = await supabase.auth.getUser()

// 登出
await supabase.auth.signOut()
```

**支持的認證方式**：
- 郵箱密碼
- Magic Link（郵件鏈接）
- OAuth（Google、GitHub、Twitter 等）
- 手機驗證碼

### 3. Storage：文件存儲

```typescript
// 上傳文件
const { data, error } = await supabase.storage
  .from('avatars')
  .upload(`${userId}/avatar.png`, file)

// 獲取公開 URL
const { data } = supabase.storage
  .from('avatars')
  .getPublicUrl(`${userId}/avatar.png`)

// 下載文件
const { data, error } = await supabase.storage
  .from('documents')
  .download('report.pdf')
```

**特點**：
- 與 Auth 集成，支持權限控制
- 自動 CDN 加速
- 支持圖片處理（縮放、裁剪）

### 4. Realtime：即時訂閱

```typescript
// 訂閱數據變更
const channel = supabase
  .channel('posts')
  .on(
    'postgres_changes',
    { event: '*', schema: 'public', table: 'posts' },
    (payload) => {
      console.log('變更:', payload)
    }
  )
  .subscribe()

// 取消訂閱
supabase.removeChannel(channel)
```

**適用場景**：
- 即時聊天
- 協作編輯
- 即時通知
- 數據看板

## 行級安全（RLS）

Supabase 最強大的特性之一是 Row Level Security：

```sql
-- 用戶只能看到自己的文章
CREATE POLICY "用戶只能查看自己的文章" ON posts
  FOR SELECT
  USING (auth.uid() = author_id);

-- 用戶只能修改自己的文章
CREATE POLICY "用戶只能修改自己的文章" ON posts
  FOR UPDATE
  USING (auth.uid() = author_id);

-- 任何人都可以查看已發佈的文章
CREATE POLICY "公開文章所有人可見" ON posts
  FOR SELECT
  USING (status = 'published');
```

## 與 Next.js 集成

### 安裝

```bash
pnpm add @supabase/supabase-js @supabase/ssr
```

### 配置

```typescript
// lib/supabase/client.ts
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

```typescript
// lib/supabase/server.ts
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export function createClient() {
  const cookieStore = cookies()
  
  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return cookieStore.get(name)?.value
        },
      },
    }
  )
}
```

### 在 Server Component 中使用

```typescript
// app/posts/page.tsx
import { createClient } from '@/lib/supabase/server'

export default async function PostsPage() {
  const supabase = createClient()
  
  const { data: posts } = await supabase
    .from('posts')
    .select('*')
    .eq('status', 'published')
  
  return (
    <ul>
      {posts?.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

## 本節小結

| 服務 | 核心價值 | 注意事項 |
|------|----------|----------|
| **Database** | 完整 PostgreSQL + 自動 API | RLS 配置複雜 |
| **Auth** | 開箱即用的認證 | 定製化受限 |
| **Storage** | 與 Auth 集成的存儲 | 大文件成本高 |
| **Realtime** | 零配置即時訂閱 | 連接數有限制 |
