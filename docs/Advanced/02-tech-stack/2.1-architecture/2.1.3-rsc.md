---
title: "2.1.3 å‰å¾Œç«¯ä»£ç¢¼å¯«ä¸€èµ·ï¼Ÿâ€”â€”RSC æ¸²æŸ“ç­–ç•¥ï¼šæœå‹™å™¨çµ„ä»¶èˆ‡å®¢æˆ¶ç«¯çµ„ä»¶"
typora-root-url: ../../public
---

# 2.1.3 å‰å¾Œç«¯ä»£ç¢¼å¯«ä¸€èµ·ï¼Ÿâ€”â€”RSC æ¸²æŸ“ç­–ç•¥

## èªçŸ¥é‡æ§‹

å‚³çµ±çš„ React æ‡‰ç”¨ä¸­ï¼Œæ‰€æœ‰çµ„ä»¶éƒ½åœ¨ç€è¦½å™¨ä¸­é‹è¡Œã€‚è€Œ React Server Componentsï¼ˆRSCï¼‰æ‰“ç ´äº†é€™å€‹é‚Šç•Œï¼š

```
å‚³çµ± Reactï¼šæ‰€æœ‰çµ„ä»¶ â†’ æ‰“åŒ… â†’ ç™¼é€åˆ°ç€è¦½å™¨ â†’ ç€è¦½å™¨åŸ·è¡Œ
RSCï¼šæœå‹™å™¨çµ„ä»¶åœ¨æœå‹™å™¨åŸ·è¡Œ â†’ åªç™¼é€æ¸²æŸ“çµæœ â†’ å®¢æˆ¶ç«¯çµ„ä»¶åœ¨ç€è¦½å™¨åŸ·è¡Œ
```

## æœ¬è³ªé‚„åŸ

```mermaid
flowchart TB
    subgraph Server["æœå‹™å™¨ç«¯"]
        SC["Server Component<br/>å¯ä»¥ç›´æ¥è¨ªå•æ•¸æ“šåº«<br/>å¯ä»¥ä½¿ç”¨æœå‹™å™¨è³‡æº<br/>ä¸æœƒç™¼é€åˆ°å®¢æˆ¶ç«¯"]
    end
    
    subgraph Client["å®¢æˆ¶ç«¯ï¼ˆç€è¦½å™¨ï¼‰"]
        CC["Client Component<br/>å¯ä»¥ä½¿ç”¨ useState/useEffect<br/>å¯ä»¥ç¶å®šäº‹ä»¶<br/>éœ€è¦ç™¼é€ JS åˆ°ç€è¦½å™¨"]
    end
    
    subgraph Output["è¼¸å‡º"]
        HTML["HTML + æœ€å°åŒ– JS"]
    end
    
    SC --> Output
    CC --> Output
```

## æœå‹™å™¨çµ„ä»¶ vs å®¢æˆ¶ç«¯çµ„ä»¶

| ç‰¹æ€§ | Server Component | Client Component |
|------|------------------|------------------|
| **é‹è¡Œç’°å¢ƒ** | æœå‹™å™¨ | ç€è¦½å™¨ |
| **è¨ªå•æ•¸æ“šåº«** | âœ… å¯ä»¥ | âŒ ä¸èƒ½ |
| **ä½¿ç”¨ Hooks** | âŒ ä¸èƒ½ç”¨ useState/useEffect | âœ… å¯ä»¥ |
| **äº‹ä»¶è™•ç†** | âŒ ä¸èƒ½ onClick | âœ… å¯ä»¥ |
| **æ‰“åŒ…å¤§å°** | ä¸è¨ˆå…¥ | è¨ˆå…¥ JS Bundle |
| **é»˜èªè¡Œçˆ²** | App Router é»˜èª | éœ€è¦ `'use client'` |

## ä½•æ™‚ä½¿ç”¨å“ªç¨®çµ„ä»¶ï¼Ÿ

```mermaid
flowchart TD
    Start["éœ€è¦å‰µå»ºçµ„ä»¶"] --> Q1{"éœ€è¦äº¤äº’ï¼Ÿ<br/>onClick/onChange"}
    Q1 -->|æ˜¯| CC["Client Component"]
    Q1 -->|å¦| Q2{"éœ€è¦ç‹€æ…‹ï¼Ÿ<br/>useState"}
    Q2 -->|æ˜¯| CC
    Q2 -->|å¦| Q3{"éœ€è¦å‰¯ä½œç”¨ï¼Ÿ<br/>useEffect"}
    Q3 -->|æ˜¯| CC
    Q3 -->|å¦| Q4{"éœ€è¦ç€è¦½å™¨ APIï¼Ÿ<br/>window/localStorage"}
    Q4 -->|æ˜¯| CC
    Q4 -->|å¦| SC["Server Component"]
    
    style SC fill:#10b981
    style CC fill:#3b82f6
```

### ç°¡å–®å£è¨£

- **éœ€è¦é»æ“Šã€è¼¸å…¥ã€å‹•ç•«** â†’ Client Component
- **åªæ˜¯å±•ç¤ºæ•¸æ“š** â†’ Server Component
- **æ‹¿ä¸æº–** â†’ å…ˆå¯«æˆ Server Componentï¼Œéœ€è¦äº¤äº’å†æ”¹

## ä»£ç¢¼ç¤ºä¾‹

### Server Componentï¼ˆé»˜èªï¼‰

```typescript
// app/posts/page.tsx
// é»˜èªå°±æ˜¯ Server Componentï¼Œä¸éœ€è¦ä»»ä½•è²æ˜

import { prisma } from '@/lib/prisma'

export default async function PostsPage() {
  // âœ… å¯ä»¥ç›´æ¥è¨ªå•æ•¸æ“šåº«
  const posts = await prisma.post.findMany()
  
  return (
    <ul>
      {posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

### Client Component

```typescript
// components/like-button.tsx
'use client'  // â† å¿…é ˆåœ¨æ–‡ä»¶é ‚éƒ¨è²æ˜

import { useState } from 'react'

export function LikeButton({ postId }: { postId: string }) {
  // âœ… å¯ä»¥ä½¿ç”¨ useState
  const [liked, setLiked] = useState(false)
  
  // âœ… å¯ä»¥ç¶å®šäº‹ä»¶
  return (
    <button onClick={() => setLiked(!liked)}>
      {liked ? 'â¤ï¸' : 'ğŸ¤'}
    </button>
  )
}
```

### æ··åˆä½¿ç”¨

```typescript
// app/posts/[id]/page.tsx - Server Component
import { prisma } from '@/lib/prisma'
import { LikeButton } from '@/components/like-button'

export default async function PostPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  // æœå‹™å™¨ç«¯ç²å–æ•¸æ“š
  const post = await prisma.post.findUnique({
    where: { id: params.id }
  })
  
  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
      {/* å®¢æˆ¶ç«¯çµ„ä»¶åµŒå…¥æœå‹™å™¨çµ„ä»¶ */}
      <LikeButton postId={post.id} />
    </article>
  )
}
```

## çµ„ä»¶é‚Šç•Œè¦å‰‡

```mermaid
flowchart TB
    subgraph Valid["âœ… åˆæ³•çš„çµ„åˆ"]
        SC1["Server Component"] --> CC1["Client Component"]
        SC2["Server Component"] --> SC3["Server Component"]
        CC2["Client Component"] --> CC3["Client Component"]
    end
    
    subgraph Invalid["âŒ ä¸åˆæ³•"]
        CC4["Client Component"] -.->|ä¸èƒ½ç›´æ¥å°å…¥| SC4["Server Component"]
    end
```

### é—œéµè¦å‰‡

1. **Server â†’ Client**ï¼šâœ… æœå‹™å™¨çµ„ä»¶å¯ä»¥å°å…¥å®¢æˆ¶ç«¯çµ„ä»¶
2. **Server â†’ Server**ï¼šâœ… æœå‹™å™¨çµ„ä»¶å¯ä»¥å°å…¥æœå‹™å™¨çµ„ä»¶
3. **Client â†’ Client**ï¼šâœ… å®¢æˆ¶ç«¯çµ„ä»¶å¯ä»¥å°å…¥å®¢æˆ¶ç«¯çµ„ä»¶
4. **Client â†’ Server**ï¼šâŒ å®¢æˆ¶ç«¯çµ„ä»¶ä¸èƒ½ç›´æ¥å°å…¥æœå‹™å™¨çµ„ä»¶

### å¦‚æœå®¢æˆ¶ç«¯çµ„ä»¶éœ€è¦åŒ…å«æœå‹™å™¨çµ„ä»¶ï¼Ÿ

ä½¿ç”¨ `children` æ¨¡å¼ï¼š

```typescript
// âœ… æ­£ç¢ºåšæ³•
// client-wrapper.tsx
'use client'
export function ClientWrapper({ children }: { children: React.ReactNode }) {
  return <div onClick={() => {}}>{children}</div>
}

// page.tsx (Server Component)
import { ClientWrapper } from './client-wrapper'
import { ServerComponent } from './server-component'

export default function Page() {
  return (
    <ClientWrapper>
      <ServerComponent />  {/* é€šé children å‚³å…¥ */}
    </ClientWrapper>
  )
}
```

## è¦ºçŸ¥ï¼šReview AI ä»£ç¢¼æ™‚çš„æª¢æŸ¥é»

### 1. `'use client'` ä½ç½®

```typescript
// âŒ éŒ¯èª¤ï¼šä¸åœ¨æ–‡ä»¶é ‚éƒ¨
import { useState } from 'react'
'use client'  // é€™æ¨£ç„¡æ•ˆ

// âœ… æ­£ç¢ºï¼šå¿…é ˆåœ¨æœ€é ‚éƒ¨
'use client'
import { useState } from 'react'
```

### 2. æœå‹™å™¨çµ„ä»¶ä¸­ä½¿ç”¨äº†å®¢æˆ¶ç«¯ API

```typescript
// âŒ AI å¯èƒ½ç”Ÿæˆé€™æ¨£çš„ä»£ç¢¼
export default function Page() {
  const [data, setData] = useState()  // æœå‹™å™¨çµ„ä»¶ä¸èƒ½ç”¨ useState
  
  useEffect(() => {  // æœå‹™å™¨çµ„ä»¶ä¸èƒ½ç”¨ useEffect
    // ...
  }, [])
}
```

### 3. æ•¸æ“šç²å–ä½ç½®

```typescript
// âŒ åœ¨å®¢æˆ¶ç«¯çµ„ä»¶ä¸­ç²å–ï¼ˆä¸å¿…è¦çš„ï¼‰
'use client'
export function PostList() {
  const [posts, setPosts] = useState([])
  useEffect(() => {
    fetch('/api/posts').then(...)  // å¤šä¸€æ¬¡ç¶²çµ¡è«‹æ±‚
  }, [])
}

// âœ… åœ¨æœå‹™å™¨çµ„ä»¶ä¸­ç›´æ¥ç²å–
export default async function PostList() {
  const posts = await prisma.post.findMany()  // ç›´æ¥è¨ªå•æ•¸æ“šåº«
  return <ul>...</ul>
}
```

## æœ¬ç¯€å°çµ

RSC çš„æ ¸å¿ƒåƒ¹å€¼ï¼š**åœ¨æ­£ç¢ºçš„åœ°æ–¹é‹è¡Œæ­£ç¢ºçš„ä»£ç¢¼**ã€‚

| å ´æ™¯ | é¸æ“‡ | åŸå›  |
|------|------|------|
| æ•¸æ“šå±•ç¤º | Server Component | æ¸›å°‘ JS Bundleï¼Œç›´æ¥è¨ªå•æ•¸æ“š |
| è¡¨å–®äº¤äº’ | Client Component | éœ€è¦ç‹€æ…‹å’Œäº‹ä»¶ |
| éœæ…‹ UI | Server Component | é›¶å®¢æˆ¶ç«¯ JS |
| å‹•ç•«æ•ˆæœ | Client Component | éœ€è¦ç€è¦½å™¨ API |
