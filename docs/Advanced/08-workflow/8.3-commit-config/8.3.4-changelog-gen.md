---
title: "8.3.4 自動生成更新日誌——發佈日誌：從提交歷史生成 CHANGELOG"
typora-root-url: ../../public
---

# 8.3.4 自動生成更新日誌——CHANGELOG 生成

規範的提交信息不只是爲了好看——它能讓工具自動生成發佈日誌。

## 爲什麼需要 CHANGELOG

CHANGELOG 是項目版本更新的"說明書"：

- 用戶知道新版本有什麼變化
- 開發者知道引入了哪些 breaking change
- 運維知道是否需要特殊的升級步驟

## 工具選擇

| 工具 | 特點 | 適用場景 |
|------|------|----------|
| conventional-changelog | 老牌工具 | 手動觸發生成 |
| standard-version | 一站式版本管理 | 中小型項目 |
| semantic-release | 全自動發佈 | CI/CD 集成 |
| changesets | Monorepo 友好 | 多包項目 |

## standard-version 使用

### 安裝

```bash
pnpm add -D standard-version
```

### 配置 package.json

```json
{
  "scripts": {
    "release": "standard-version",
    "release:minor": "standard-version --release-as minor",
    "release:major": "standard-version --release-as major"
  }
}
```

### 使用流程

```bash
# 根據提交歷史自動決定版本號
pnpm release

# 指定版本類型
pnpm release:minor  # 1.0.0 -> 1.1.0
pnpm release:major  # 1.0.0 -> 2.0.0

# 首次發佈
pnpm release -- --first-release
```

執行後會：
1. 分析提交歷史，確定版本號
2. 更新 `package.json` 的 version
3. 生成/更新 `CHANGELOG.md`
4. 創建版本提交和 tag

### 版本號規則

基於 Semantic Versioning：

| 提交類型 | 版本變更 | 示例 |
|----------|----------|------|
| feat | minor | 1.0.0 → 1.1.0 |
| fix | patch | 1.0.0 → 1.0.1 |
| BREAKING CHANGE | major | 1.0.0 → 2.0.0 |

## CHANGELOG 輸出示例

```markdown
# Changelog

## [1.2.0](https://github.com/user/repo/compare/v1.1.0...v1.2.0) (2024-01-15)

### Features

* **auth:** 添加 Google OAuth 登錄 ([#123](https://github.com/user/repo/issues/123)) ([abc1234](https://github.com/user/repo/commit/abc1234))
* **ui:** 支持暗黑模式切換 ([def5678](https://github.com/user/repo/commit/def5678))

### Bug Fixes

* **api:** 修復分頁查詢參數解析錯誤 ([#145](https://github.com/user/repo/issues/145)) ([ghi9012](https://github.com/user/repo/commit/ghi9012))

## [1.1.0](https://github.com/user/repo/compare/v1.0.0...v1.1.0) (2024-01-01)

### Features

* 初始化項目結構 ([jkl3456](https://github.com/user/repo/commit/jkl3456))
```

## 自定義配置

創建 `.versionrc.json`：

```json
{
  "types": [
    { "type": "feat", "section": "Features" },
    { "type": "fix", "section": "Bug Fixes" },
    { "type": "perf", "section": "Performance" },
    { "type": "refactor", "section": "Refactoring", "hidden": true },
    { "type": "docs", "section": "Documentation", "hidden": true },
    { "type": "style", "hidden": true },
    { "type": "chore", "hidden": true },
    { "type": "test", "hidden": true },
    { "type": "build", "hidden": true },
    { "type": "ci", "hidden": true }
  ],
  "commitUrlFormat": "https://github.com/user/repo/commit/{{hash}}",
  "compareUrlFormat": "https://github.com/user/repo/compare/{{previousTag}}...{{currentTag}}"
}
```

## CI/CD 集成

### GitHub Actions 自動發佈

```yaml
# .github/workflows/release.yml
name: Release

on:
  push:
    branches: [main]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - run: pnpm install

      - name: Release
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          pnpm release
          git push --follow-tags origin main
```

## semantic-release（進階）

適合完全自動化的項目：

```bash
pnpm add -D semantic-release @semantic-release/changelog @semantic-release/git
```

配置 `.releaserc.json`：

```json
{
  "branches": ["main"],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    "@semantic-release/npm",
    "@semantic-release/git",
    "@semantic-release/github"
  ]
}
```

## 最佳實踐

1. **保持提交規範**：CHANGELOG 質量取決於提交信息質量
2. **關聯 Issue**：讓變更可追溯
3. **標記 Breaking Change**：讓用戶知道如何升級
4. **定期發佈**：避免 CHANGELOG 過長

## AI 協作指南

**示例 Prompt**：
> "請根據以下 Git 提交歷史，幫我生成一份 CHANGELOG：
> - feat(auth): 添加微信登錄
> - fix(api): 修復用戶查詢分頁問題
> - feat(ui): 新增用戶設置頁面
> - perf(database): 優化查詢性能"

## 驗收清單

- [ ] 安裝並配置 standard-version
- [ ] 能執行 release 命令生成 CHANGELOG
- [ ] 理解版本號自動變更規則
- [ ] 可選：配置 CI 自動發佈
