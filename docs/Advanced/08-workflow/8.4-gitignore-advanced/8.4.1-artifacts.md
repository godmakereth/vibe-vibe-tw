---
title: "8.4.1 黑名單第一條：`node_modules`——依賴/構建產物：`.next/`、`out/`、日誌"
typora-root-url: ../../public
---

# 8.4.1 黑名單第一條——依賴與構建產物

node_modules 是 .gitignore 的頭號目標——它太大、能重建、每個人的都可能不同。

## 依賴目錄

### node_modules

```gitignore
# 任何位置的 node_modules
**/node_modules/

# pnpm 存儲（如果使用）
.pnpm-store/
```

**爲什麼不提交**：
- 體積巨大（幾百 MB 到幾 GB）
- 可通過 `pnpm install` 完全恢復
- 不同系統可能有平臺相關的二進制文件

**正確做法**：
- 提交 `package.json` 和 `pnpm-lock.yaml`
- 通過鎖文件確保依賴版本一致

### 其他依賴目錄

```gitignore
# Python
__pycache__/
*.pyc
venv/
.venv/

# Go
vendor/

# Ruby
.bundle/
```

## 構建產物

### Next.js 構建

```gitignore
# Next.js 開發和生產構建
.next/

# 靜態導出
out/

# 獨立部署
.next/standalone/
```

### 通用構建目錄

```gitignore
# 常見構建輸出
dist/
build/
output/

# TypeScript 編譯
*.tsbuildinfo

# Webpack/Vite
.cache/
```

### 打包工具產物

```gitignore
# Turbo
.turbo/

# Storybook
storybook-static/

# Bundle 分析
.next/analyze/
stats.html
```

## 日誌文件

```gitignore
# npm/pnpm 日誌
npm-debug.log*
pnpm-debug.log*
yarn-debug.log*
yarn-error.log*

# 應用日誌
*.log
logs/
*.log.*

# PM2 日誌
.pm2/logs/
```

## 測試與覆蓋率

```gitignore
# Jest/Vitest
coverage/
.nyc_output/

# Playwright
test-results/
playwright-report/
playwright/.cache/

# Cypress
cypress/screenshots/
cypress/videos/
```

## 完整示例

```gitignore
# =========================================
# 依賴
# =========================================
node_modules/
.pnpm-store/

# =========================================
# 構建產物
# =========================================
.next/
out/
dist/
build/
*.tsbuildinfo

# =========================================
# 日誌
# =========================================
*.log
npm-debug.log*
pnpm-debug.log*

# =========================================
# 測試
# =========================================
coverage/
test-results/
playwright-report/

# =========================================
# 緩存
# =========================================
.cache/
.turbo/
.eslintcache
```

## 已提交的文件如何處理

如果不小心提交了 node_modules：

```bash
# 1. 添加到 .gitignore
echo "node_modules/" >> .gitignore

# 2. 從 Git 歷史中移除（但保留本地文件）
git rm -r --cached node_modules/

# 3. 提交變更
git commit -m "chore: 移除 node_modules 並添加到 gitignore"

# 4. 如果已推送，需要強制推送（謹慎使用）
git push --force-with-lease
```

## AI 協作指南

**示例 Prompt**：
> "我的 Next.js 項目用 pnpm 和 Prisma，請幫我生成完整的 .gitignore，包含依賴、構建產物、日誌等。"

## 驗收清單

- [ ] 理解 node_modules 不該提交的原因
- [ ] 能配置構建產物的忽略規則
- [ ] 知道如何處理意外提交的文件
- [ ] 理解日誌和測試產物的忽略
