---
title: "8.1.5 哪些文件不該被穿越——.gitignore 作用：版本控制的邊界管理"
typora-root-url: ../../public
---

# 8.1.5 哪些文件不該被穿越——.gitignore 的作用

不是所有文件都應該被 Git 追蹤——密鑰、依賴包、構建產物都應該被排除在版本控制之外。

## 爲什麼需要 .gitignore

將不該提交的文件納入版本控制會帶來嚴重問題：

| 問題類型 | 後果 |
|----------|------|
| 提交敏感信息 | API 密鑰、密碼泄露，可能導致安全事故 |
| 提交依賴包 | 倉庫體積暴增，clone 速度極慢 |
| 提交構建產物 | 每次構建都產生大量無意義變更 |
| 提交系統文件 | `.DS_Store`、`Thumbs.db` 污染倉庫 |

## .gitignore 基礎語法

```gitignore
# 這是註釋

# 忽略單個文件
.env

# 忽略特定目錄
node_modules/
.next/

# 忽略所有 .log 文件
*.log

# 忽略所有目錄下的 .DS_Store
**/.DS_Store

# 但不忽略 important.log
!important.log

# 忽略根目錄下的 build，但不忽略子目錄的 build
/build

# 忽略 doc 目錄下所有 .txt 文件
doc/**/*.txt
```

### 語法規則速查

| 模式 | 說明 | 示例 |
|------|------|------|
| `*` | 匹配任意字符（不含 /） | `*.log` |
| `**` | 匹配任意目錄層級 | `**/node_modules` |
| `?` | 匹配單個字符 | `?.txt` |
| `[]` | 匹配字符集 | `[abc].txt` |
| `/` 開頭 | 只匹配根目錄 | `/build` |
| `/` 結尾 | 只匹配目錄 | `logs/` |
| `!` | 取反（不忽略） | `!important.log` |

## Next.js 項目推薦配置

```gitignore
# 依賴
node_modules/
.pnpm-store/

# Next.js 構建產物
.next/
out/

# 環境變量（敏感信息）
.env
.env.local
.env.*.local

# 日誌
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# IDE
.vscode/
.idea/
*.swp
*.swo

# 系統文件
.DS_Store
Thumbs.db

# TypeScript
*.tsbuildinfo

# 測試覆蓋率
coverage/

# Vercel
.vercel

# Prisma
prisma/*.db
prisma/*.db-journal
```

## 常見問題處理

### 已提交的文件如何從 Git 中移除

```bash
# 從 Git 追蹤中移除，但保留本地文件
git rm --cached .env

# 從 Git 追蹤中移除整個目錄
git rm -r --cached node_modules/

# 添加到 .gitignore
echo ".env" >> .gitignore

# 提交變更
git commit -m "chore: 移除敏感文件並更新 gitignore"
```

### 檢查文件爲什麼被忽略

```bash
# 檢查某個文件是否被忽略
git check-ignore -v path/to/file

# 檢查哪些文件被追蹤
git ls-files
```

### 全局 .gitignore

對於所有項目都需要忽略的文件（如 IDE 配置），可以設置全局配置：

```bash
# 創建全局 gitignore 文件
touch ~/.gitignore_global

# 配置 Git 使用它
git config --global core.excludesfile ~/.gitignore_global
```

常見全局忽略內容：

```gitignore
# macOS
.DS_Store
.AppleDouble
.LSOverride

# Windows
Thumbs.db
ehthumbs.db
Desktop.ini

# IDE
.idea/
.vscode/
*.sublime-project
*.sublime-workspace
```

## .gitignore 模板資源

- **gitignore.io**：根據項目類型生成 .gitignore
- **GitHub gitignore 倉庫**：官方維護的各語言/框架模板

```bash
# 使用 gitignore.io 生成
curl -sL https://www.toptal.com/developers/gitignore/api/node,nextjs > .gitignore
```

## AI 協作指南

**示例 Prompt**：
> "請幫我生成一個 Next.js + Prisma + TypeScript 項目的 .gitignore 文件，包含 macOS 和 Windows 系統文件、VS Code 配置、環境變量、依賴和構建產物。"

## 驗收清單

- [ ] 理解 .gitignore 的作用和重要性
- [ ] 能編寫基本的忽略規則
- [ ] 知道如何移除已追蹤的文件
- [ ] 瞭解全局 .gitignore 的配置方法
