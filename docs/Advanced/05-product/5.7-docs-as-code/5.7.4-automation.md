---
title: "5.7.4 讓機器提醒你更新文檔——自動化檢查：CI 驗證文檔完整性"
typora-root-url: ../../public
---

# 5.7.4 讓機器提醒你更新文檔——自動化檢查

### 一句話破題

用 CI 自動檢查文檔，**讓機器代替人工提醒**你更新文檔。

### 自動化檢查的價值

```
沒有自動化：
  提交代碼 → 忘了更新文檔 → 合併 → 發現文檔過時 → 再補

有自動化：
  提交代碼 → CI 檢查文檔 → 提醒缺失 → 補上文檔 → 合併
```

### 可以自動檢查什麼

| 檢查項 | 工具 | 說明 |
|--------|------|------|
| Markdown 格式 | markdownlint | 格式規範 |
| 鏈接有效性 | markdown-link-check | 死鏈檢查 |
| 拼寫檢查 | cspell | 單詞拼寫 |
| 文檔覆蓋率 | 自定義腳本 | API 文檔完整性 |

### 基礎 CI 配置

GitHub Actions 示例：

```yaml
# .github/workflows/docs.yml
name: Docs Check

on:
  push:
    paths:
      - 'docs/**'
      - '*.md'
  pull_request:
    paths:
      - 'docs/**'
      - '*.md'

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Lint Markdown
        uses: DavidAnson/markdownlint-cli2-action@v14
        with:
          globs: '**/*.md'
```

### Markdown 格式檢查

創建配置文件 `.markdownlint.json`：

```json
{
  "default": true,
  "MD013": false,
  "MD033": false,
  "MD041": false
}
```

常見規則：
- MD013：行長度限制（通常禁用）
- MD033：禁止 HTML（通常禁用）
- MD041：首行必須是標題

### 鏈接檢查

檢查文檔中的鏈接是否有效：

```yaml
- name: Check Links
  uses: gaurav-nelson/github-action-markdown-link-check@v1
  with:
    use-quiet-mode: 'yes'
    config-file: '.markdown-link-check.json'
```

配置文件 `.markdown-link-check.json`：

```json
{
  "ignorePatterns": [
    { "pattern": "^https://localhost" }
  ],
  "timeout": "10s",
  "retryOn429": true
}
```

### 文檔覆蓋率檢查

自定義腳本檢查 API 文檔完整性：

```javascript
// scripts/check-docs.js
const fs = require('fs')
const path = require('path')

// 獲取所有 API 路由
const apiDir = 'src/app/api'
const routes = fs.readdirSync(apiDir, { recursive: true })
  .filter(f => f.endsWith('route.ts'))
  .map(f => path.dirname(f))

// 檢查文檔是否存在
const docsDir = 'docs/api'
const missing = routes.filter(route => {
  const docPath = path.join(docsDir, `${route}.md`)
  return !fs.existsSync(docPath)
})

if (missing.length > 0) {
  console.error('Missing docs for:', missing)
  process.exit(1)
}

console.log('All APIs have docs!')
```

### PR 模板提醒

創建 PR 模板 `.github/pull_request_template.md`：

```markdown
## 變更說明

### 代碼變更
-

### 文檔更新
- [ ] 不需要更新文檔
- [ ] 已更新 API 文檔
- [ ] 已更新 README
- [ ] 已更新部署文檔

### 測試
- [ ] 本地測試通過
```

### 簡化版自動化

對於個人項目，可以用最簡單的方式：

```yaml
# .github/workflows/docs.yml
name: Docs

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check Markdown
        run: npx markdownlint-cli2 "**/*.md"
```

### 本地預檢查

在提交前本地檢查：

```json
// package.json
{
  "scripts": {
    "docs:lint": "markdownlint-cli2 '**/*.md'",
    "docs:links": "markdown-link-check docs/**/*.md"
  }
}
```

使用 husky 添加 pre-commit hook：

```bash
# 安裝
pnpm add -D husky
npx husky install

# 添加 hook
npx husky add .husky/pre-commit "pnpm docs:lint"
```

### 實用建議

1. **從簡單開始**：先做格式檢查，再逐步添加
2. **不要過度**：檢查太嚴格會讓人厭煩
3. **快速反饋**：CI 檢查要快，幾分鐘內完成
4. **提供修復建議**：告訴開發者如何修復問題
