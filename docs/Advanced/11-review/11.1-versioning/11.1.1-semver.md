---
title: "11.1.1 版本號的祕密——SemVer 規範：主版本/次版本/修訂版本"
typora-root-url: ../../public
---

# 11.1.1 SemVer 規範：主版本/次版本/修訂版本

## 一句話破題

**語義化版本（SemVer）**是一套版本號命名規範，格式爲 `主版本.次版本.修訂版本`，每個數字的變化都傳達了特定的含義。

## 核心價值

理解 SemVer 能讓你：
- 正確判斷依賴升級的風險
- 爲自己的項目設置合理的版本號
- 與團隊和用戶建立明確的版本契約

## 三個數字的含義

```
1.2.3
│ │ └── 修訂版本（Patch）：修復 Bug，向後兼容
│ └──── 次版本（Minor）：新功能，向後兼容
└────── 主版本（Major）：破壞性變更，不向後兼容
```

| 版本變化 | 含義 | 用戶需要做什麼 |
|----------|------|----------------|
| `1.0.0` → `1.0.1` | 修復了 Bug | 放心升級 |
| `1.0.0` → `1.1.0` | 新增了功能 | 放心升級，可使用新功能 |
| `1.0.0` → `2.0.0` | 有破壞性變更 | 需要閱讀升級指南 |

## 快速上手

### 在 package.json 中設置版本

```json
{
  "name": "my-app",
  "version": "1.2.3"
}
```

### 使用 npm 命令更新版本

```bash
# 修復 Bug：1.2.3 → 1.2.4
npm version patch

# 新增功能：1.2.3 → 1.3.0
npm version minor

# 破壞性變更：1.2.3 → 2.0.0
npm version major
```

### 預發佈版本

```bash
# 1.2.3 → 1.2.4-alpha.0
npm version prerelease --preid=alpha

# 1.2.3 → 1.2.4-beta.0
npm version prerelease --preid=beta

# 1.2.3 → 1.2.4-rc.0
npm version prerelease --preid=rc
```

## 特殊規則

### 0.x.x 版本

`0.x.x` 版本表示項目仍在初期開發階段，API 可能隨時變化：

```
0.1.0  ─→  初始開發版本
0.2.0  ─→  可能有破壞性變更
0.2.1  ─→  Bug 修復
1.0.0  ─→  第一個穩定版本
```

### 版本號比較

```typescript
// 比較版本號的簡單實現
function compareVersions(a: string, b: string): number {
  const [aMajor, aMinor, aPatch] = a.split('.').map(Number)
  const [bMajor, bMinor, bPatch] = b.split('.').map(Number)
  
  if (aMajor !== bMajor) return aMajor - bMajor
  if (aMinor !== bMinor) return aMinor - bMinor
  return aPatch - bPatch
}

compareVersions('1.2.3', '1.2.4')  // -1（a < b）
compareVersions('2.0.0', '1.9.9')  // 1（a > b）
```

## 依賴版本範圍

在 `package.json` 中，可以指定依賴的版本範圍：

| 符號 | 含義 | 示例 |
|------|------|------|
| `^` | 允許次版本和修訂版本更新 | `^1.2.3` → `1.x.x` |
| `~` | 只允許修訂版本更新 | `~1.2.3` → `1.2.x` |
| 無符號 | 鎖定精確版本 | `1.2.3` → 只用 `1.2.3` |

```json
{
  "dependencies": {
    "react": "^18.2.0",      // 18.2.0 ~ 18.x.x
    "lodash": "~4.17.21",    // 4.17.21 ~ 4.17.x
    "typescript": "5.3.2"    // 精確鎖定
  }
}
```

## 避坑指南

::: danger 新手最容易犯的錯
1. 在 `1.x.x` 版本引入破壞性變更但不升主版本號
2. 忘記在發佈前更新版本號
3. 手動修改 `package.json` 而不用 `npm version`
4. 不理解 `^` 和 `~` 的區別導致意外升級
:::
