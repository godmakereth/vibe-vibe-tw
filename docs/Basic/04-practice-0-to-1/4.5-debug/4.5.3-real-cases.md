---
title: "4.5.3 真實案例覆盤"
order: 4
---

# 4.5.3 真實案例覆盤

本節展示 6 個待辦清單開發中的典型錯誤，包括完整的報錯信息、診斷過程和修復對話。

## 案例速查

| 案例 | 錯誤類型 | 錯誤信息關鍵詞 |
|------|---------|---------------|
| [案例 1](#案例-1-任務列表是-undefined) | TypeError | `Cannot read properties of undefined` |
| [案例 2](#案例-2-函數未定義) | ReferenceError | `is not defined` |
| [案例 3](#案例-3-localstorage-解析失敗) | SyntaxError | `Unexpected token` |
| [案例 4](#案例-4-點擊按鈕沒反應) | 邏輯錯誤 | 無報錯 |
| [案例 5](#案例-5-樣式突然消失) | CSS 錯誤 | 無報錯 |
| [案例 6](#案例-6-完成狀態無法保存) | 邏輯錯誤 | 無報錯 |

## 案例 1：任務列表是 undefined

### 錯誤現象

點擊添加按鈕後，任務沒有出現。控制檯顯示紅色報錯。

### 控制檯報錯

```
Uncaught TypeError: Cannot read properties of undefined (reading 'push')
    at addTask (index.html:45:15)
    at HTMLButtonElement.<anonymous> (index.html:52:5)
```

### 問題定位

這個錯誤的意思是：代碼試圖對 `undefined` 調用 `push` 方法。`push` 是數組的方法，說明代碼期望這是一個數組，但實際上是 `undefined`。

查看第 45 行代碼：

```javascript
tasks.push({ text: taskText, completed: false });
```

問題出在 `tasks` 變量上——它沒有被正確初始化。

### 診斷對話

**你發送的 Prompt**：
```
我的待辦清單代碼報錯了：

【現象】點擊添加按鈕後，任務沒有出現
【報錯】Uncaught TypeError: Cannot read properties of undefined (reading 'push')
    at addTask (index.html:45:15)

【代碼】
function addTask() {
    const input = document.querySelector('.task-input');
    const taskText = input.value.trim();
    if (taskText) {
        tasks.push({ text: taskText, completed: false });
        renderTasks();
        input.value = '';
    }
}

請幫我分析原因。
```

**AI 的分析**：
> 這個錯誤表示 `tasks` 變量在調用 `push` 時是 `undefined`。問題原因是 `tasks` 沒有在使用前初始化爲數組。你需要在代碼開頭聲明 `let tasks = [];`。

### 修復對話

**你發送的 Prompt**：
```
請幫我修復。需要：
1. 在代碼開頭初始化 tasks 變量
2. 給我修復後的完整代碼
```

**AI 給出的修復代碼**（關鍵部分）：

```javascript
// 在代碼開頭添加這一行
let tasks = [];  // 初始化任務數組

function addTask() {
    const input = document.querySelector('.task-input');
    const taskText = input.value.trim();
    if (taskText) {
        tasks.push({ text: taskText, completed: false });
        renderTasks();
        input.value = '';
    }
}
```

### 驗證方法

1. 替換代碼後刷新頁面
2. 在輸入框輸入任務，點擊添加
3. 確認任務出現在列表中
4. 確認控制檯沒有紅色報錯

## 案例 2：函數未定義

### 錯誤現象

頁面加載後，控制檯立即顯示報錯。

### 控制檯報錯

```
Uncaught ReferenceError: addTask is not defined
    at HTMLButtonElement.onclick (index.html:15:42)
```

### 問題定位

`ReferenceError: xxx is not defined` 表示代碼中使用了一個不存在的變量或函數。

常見原因：
- 函數名拼寫錯誤
- 函數定義在調用之後（代碼順序問題）
- 函數寫在了錯誤的位置

### 診斷對話

**你發送的 Prompt**：
```
頁面加載就報錯：ReferenceError: addTask is not defined

我的 HTML 中有這樣的按鈕：
<button onclick="addTask()">添加</button>

我的 JavaScript 中有這個函數：
function addtask() {
    // ... 函數內容
}

請幫我分析原因。
```

**AI 的分析**：
> 問題在於函數名大小寫不一致。HTML 中調用的是 `addTask()`（T 大寫），但 JavaScript 中定義的是 `addtask()`（t 小寫）。JavaScript 對大小寫敏感，這兩個被視爲不同的函數。

### 修復方法

將 JavaScript 中的函數名改爲 `addTask`（與 HTML 中一致）：

```javascript
// 修改前
function addtask() {

// 修改後
function addTask() {
```

### 驗證方法

1. 替換代碼後刷新頁面
2. 確認控制檯沒有 `ReferenceError`
3. 點擊添加按鈕，確認功能正常

## 案例 3：localStorage 解析失敗

### 錯誤現象

頁面加載時報錯，之前保存的任務無法顯示。

### 控制檯報錯

```
Uncaught SyntaxError: Unexpected token 'u', "undefined" is not valid JSON
    at JSON.parse (<anonymous>)
    at loadTasks (index.html:68:24)
```

### 問題定位

這個錯誤發生在 `JSON.parse()` 時。錯誤信息 `"undefined" is not valid JSON` 表示試圖解析的內容是字符串 `"undefined"`，而不是有效的 JSON。

常見原因：
- localStorage 中沒有數據時，`getItem` 返回 `null`
- 代碼沒有處理 `null` 的情況，直接傳給了 `JSON.parse`

### 診斷對話

**你發送的 Prompt**：
```
localStorage 讀取報錯：SyntaxError: Unexpected token 'u', "undefined" is not valid JSON

我的讀取代碼：
function loadTasks() {
    const saved = localStorage.getItem('todoList');
    tasks = JSON.parse(saved);
    renderTasks();
}

請幫我分析。
```

**AI 的分析**：
> 當 localStorage 中沒有 'todoList' 這個鍵時，`getItem` 返回 `null`。`JSON.parse(null)` 會嘗試解析，但在某些情況下可能導致問題。更常見的是，如果之前錯誤地存儲了 `undefined` 字符串，就會出現這個錯誤。你需要在解析前檢查數據是否存在。

### 修復對話

**你發送的 Prompt**：
```
請幫我修復 loadTasks 函數，確保：
1. 如果 localStorage 沒有數據，使用空數組
2. 如果數據格式不對，也使用空數組
3. 給我完整的修復代碼
```

**AI 給出的修復代碼**：

```javascript
function loadTasks() {
    const saved = localStorage.getItem('todoList');
    
    // 檢查是否有保存的數據
    if (saved && saved !== 'undefined') {
        try {
            tasks = JSON.parse(saved);
        } catch (e) {
            // 如果解析失敗，使用空數組
            console.log('數據格式錯誤，已重置');
            tasks = [];
        }
    } else {
        // 沒有保存的數據，使用空數組
        tasks = [];
    }
    
    renderTasks();
}
```

### 驗證方法

1. 替換代碼後刷新頁面
2. 確認控制檯沒有報錯
3. 添加幾個任務，刷新頁面，確認任務還在

## 案例 4：點擊按鈕沒反應

### 錯誤現象

點擊添加按鈕，沒有任何反應。控制檯也沒有報錯。

### 問題定位

這是典型的「邏輯錯誤」——代碼語法正確，但行爲不符合預期。

可能原因：
- 事件監聽器沒有正確綁定
- 按鈕的選擇器寫錯了
- 代碼執行順序問題（在 DOM 加載前就執行了）

### 診斷對話

**你發送的 Prompt**：
```
我的添加按鈕點擊沒反應，控制檯也沒有報錯。

HTML 中的按鈕：
<button class="add-btn">添加</button>

JavaScript 中的綁定：
const addBtn = document.querySelector('.add-button');
addBtn.addEventListener('click', addTask);

請幫我排查問題。
```

**AI 的分析**：
> 問題在於 CSS 選擇器不匹配。你的 HTML 中按鈕的 class 是 `add-btn`，但 JavaScript 中查找的是 `.add-button`。由於找不到元素，`addBtn` 是 `null`，後續的 `addEventListener` 調用失敗（雖然有時不報錯）。

### 修復方法

統一選擇器名稱：

```javascript
// 修改前（選擇器不匹配）
const addBtn = document.querySelector('.add-button');

// 修改後（與 HTML 一致）
const addBtn = document.querySelector('.add-btn');
```

### 驗證方法

1. 替換代碼後刷新頁面
2. 點擊添加按鈕，確認功能正常

## 案例 5：樣式突然消失

### 錯誤現象

讓 AI 添加新功能後，整個頁面的樣式都消失了，變成了純文本。

### 問題定位

這通常發生在 AI 修改代碼時，不小心刪除或破壞了 CSS 部分。

常見原因：
- AI 只返回了 JavaScript 部分，你替換時覆蓋了整個文件
- CSS 代碼中出現了語法錯誤
- `<style>` 標籤被誤刪

### 診斷對話

**你發送的 Prompt**：
```
我讓你添加刪除功能後，頁面樣式全部消失了。
現在頁面只顯示純文本，沒有任何樣式。

請幫我排查：
1. 檢查 <style> 標籤是否完整
2. 檢查 CSS 語法是否有錯誤
3. 如果樣式丟失，請幫我恢復

這是我現在的完整 HTML 文件：
[粘貼完整代碼]
```

**AI 的分析**：
> 我發現問題了。在之前的修改中，`<style>` 標籤被誤刪除了。我會幫你恢復完整的樣式代碼。

### 修復方法

讓 AI 重新生成包含完整樣式的代碼，或者從之前的版本中恢復 CSS 部分。

### 預防措施

- 每次讓 AI 修改代碼前，先備份當前版本
- 明確告訴 AI：「只修改 JavaScript 部分，不要改動 HTML 和 CSS」
- 收到 AI 的代碼後，先檢查結構是否完整再替換

## 案例 6：完成狀態無法保存

### 錯誤現象

標記任務爲「已完成」後，刷新頁面，任務恢復爲「未完成」狀態。

### 問題定位

這是數據持久化的邏輯錯誤——完成狀態的變更沒有觸發保存操作。

### 診斷對話

**你發送的 Prompt**：
```
任務的完成狀態無法保存。

【復現步驟】
1. 添加一個任務
2. 點擊完成按鈕，任務顯示爲已完成
3. 刷新頁面
4. 任務恢復爲未完成狀態

【現象】
添加和刪除操作都能保存，但完成狀態不行

【相關代碼】
function toggleComplete(index) {
    tasks[index].completed = !tasks[index].completed;
    renderTasks();
}

function saveTasks() {
    localStorage.setItem('todoList', JSON.stringify(tasks));
}

請幫我分析原因。
```

**AI 的分析**：
> `toggleComplete` 函數修改了任務狀態並重新渲染，但沒有調用 `saveTasks()` 保存到 localStorage。添加和刪除功能能保存，可能是因爲它們的函數中調用了 `saveTasks()`，但 `toggleComplete` 漏掉了。

### 修復對話

**你發送的 Prompt**：
```
請幫我修復，在 toggleComplete 函數中添加保存操作。
```

**AI 給出的修復代碼**：

```javascript
function toggleComplete(index) {
    tasks[index].completed = !tasks[index].completed;
    saveTasks();  // 添加這一行：保存到 localStorage
    renderTasks();
}
```

### 驗證方法

1. 替換代碼後刷新頁面
2. 添加一個任務
3. 點擊完成按鈕
4. 刷新頁面
5. 確認任務仍然顯示爲已完成

## 本節要點

- 每個案例都遵循「現象 → 報錯 → 定位 → 修復 → 驗證」的流程
- TypeError 通常是變量未定義或類型不對
- ReferenceError 通常是拼寫錯誤或作用域問題
- SyntaxError 在 JSON.parse 時常見於數據爲空或格式錯誤
- 邏輯錯誤沒有報錯信息，需要對比「期望行爲」和「實際行爲」
- 樣式錯誤要檢查 CSS 代碼是否完整

掌握了這些案例，你就能應對待辦清單開發中的大部分問題。

→ [4.5.4 Debug 心法總結](./4.5.4-debug-mindset.md)
