---
title: "4.4.2 使用本地存儲（localStorage）"
order: 3
---

# 4.4.2 使用本地存儲（localStorage）

> **本步目標**：讓 AI 幫我們實現數據的自動保存和讀取

本節是數據存儲的核心實現。我們會分兩步完成：先實現「保存」，再實現「讀取」。

## 技術小貼士：理解 localStorage

在開始之前，用一個生活類比幫你建立直覺：

| 生活場景 | 對應概念 |
|---------|---------|
| 快遞寄存櫃 | localStorage |
| 櫃子編號（如 A-15） | 存儲的 key（鍵名） |
| 櫃子裏的包裹 | 存儲的 value（值） |
| 存包裹 | `localStorage.setItem(key, value)` |
| 取包裹 | `localStorage.getItem(key)` |

就像快遞櫃一樣，localStorage 可以幫你"寄存"數據，下次來還能取回來。

::: warning 注意
localStorage 只能存儲文本（字符串）。如果要存儲任務列表這樣的複雜數據，需要先把它轉換成文本格式（JSON），取出來時再轉回去。這個轉換 AI 會自動幫你處理。
:::

## 步驟 1：添加保存和讀取功能

我們用一個完整的 Prompt，讓 AI 同時實現保存和讀取邏輯。

### 完整 Prompt

複製下面的 Prompt，發送給你的 AI IDE：

```
【背景】
我有一個待辦清單網頁，目前已經實現了添加、刪除、標記完成的功能。
但刷新頁面後，所有任務都會消失。
我需要添加數據持久化功能，讓任務能夠保存下來。

【當前任務】
請幫我實現 localStorage 數據存儲功能：

1. 保存功能：
   - 每當任務列表發生變化（添加、刪除、完成狀態改變）時
   - 自動將當前任務列表保存到 localStorage
   - 使用 "todoList" 作爲存儲的 key 名

2. 讀取功能：
   - 頁面加載時，自動從 localStorage 讀取之前保存的任務
   - 如果有保存的數據，用它來初始化任務列表
   - 如果沒有保存的數據（第一次使用），顯示空列表

3. 數據格式：
   - 每個任務需要保存：任務內容、完成狀態
   - 使用 JSON 格式存儲

【技術要求】
- 使用原生 JavaScript
- 關鍵邏輯添加中文註釋
- 確保保存和讀取的數據格式一致

【我是初學者】
請保持代碼簡潔易懂，並解釋關鍵的保存/讀取邏輯。
```

### 預期結果

發送 Prompt 後，AI 會更新你的代碼。替換文件內容後：

1. **表面上看起來沒變化** - 頁面還是和之前一樣
2. **但數據已經在自動保存了** - 每次操作都會觸發保存

### 如何確認保存生效？

用瀏覽器開發者工具查看：

1. 按 **F12** 打開開發者工具
2. 點擊頂部的 **Application**（應用程序）標籤
3. 在左側找到 **Storage > Local Storage**
4. 點擊你的網頁地址
5. 你應該能看到一條 key 爲 `todoList` 的數據

::: tip 截圖對照
如果操作正確，你會看到類似這樣的界面：
- 左側：Local Storage > `file://` 或你的網址
- 右側：Key 列顯示 `todoList`，Value 列顯示類似 `[{"text":"買牛奶","completed":false}]` 的內容
:::

### 檢查點

在繼續之前，確認以下幾點：

- [ ] 代碼更新後，頁面能正常顯示
- [ ] 添加一個任務，開發者工具中能看到 `todoList` 數據
- [ ] 再添加一個任務，`todoList` 的值會更新
- [ ] 標記一個任務爲完成，`todoList` 的值會更新
- [ ] 刪除一個任務，`todoList` 的值會更新

### 常見問題排查

#### 問題 1：開發者工具中看不到 Local Storage

**可能原因**：你可能打開的是 Console 或其他標籤頁。

**解決方法**：
- 確保點擊的是 **Application** 標籤（不是 Elements、Console 等）
- 如果找不到 Application，試試點擊 **>>** 展開更多標籤

#### 問題 2：Local Storage 中沒有 todoList

**可能原因**：保存邏輯沒有正確執行。

**修復 Prompt**：
```
我按照你的代碼修改了，但是在瀏覽器的 Local Storage 中看不到 todoList 數據。
請檢查保存邏輯，確保每次任務變化時都會調用 localStorage.setItem。
給我檢查後的完整代碼。
```

#### 問題 3：todoList 的值是 undefined 或 [object Object]

**可能原因**：數據沒有正確轉換爲 JSON 字符串。

**修復 Prompt**：
```
Local Storage 中的 todoList 值顯示爲 [object Object] 或 undefined。
請確保保存時使用 JSON.stringify 轉換數據，讀取時使用 JSON.parse 解析數據。
給我修復後的完整代碼。
```

#### 問題 4：頁面報錯，功能不正常

**排查步驟**：
1. 按 F12 打開開發者工具
2. 點擊 **Console** 標籤
3. 查看紅色的報錯信息

**修復 Prompt**：
```
更新代碼後頁面報錯了。
控制檯報錯信息：[粘貼你看到的紅色報錯內容]
請幫我修復這個問題。
```

## 步驟 2：驗證刷新後數據恢復

保存功能確認正常後，現在驗證最關鍵的部分——**刷新頁面後數據是否還在**。

### 驗證流程

1. 確保當前有 1-2 個任務（如果沒有，先添加幾個）
2. 標記其中一個爲已完成
3. **刷新頁面**（按 F5 或點擊瀏覽器刷新按鈕）
4. 檢查結果

### 預期結果

| 檢查項 | 刷新前 | 刷新後（預期） |
|--------|-------|---------------|
| 任務數量 | 2 個 | 2 個（不變） |
| 任務內容 | "買牛奶"、"寫報告" | 相同（不變） |
| 完成狀態 | "買牛奶"已完成 | 仍然是已完成 |

### 如果刷新後數據丟失

**可能原因**：讀取邏輯沒有正確執行。

**修復 Prompt**：
```
保存功能正常（我能在 Local Storage 中看到數據），
但刷新頁面後，任務列表變空了，沒有從 localStorage 讀取數據。

請檢查頁面加載時的讀取邏輯，確保：
1. 頁面加載時會調用 localStorage.getItem("todoList")
2. 讀取到的數據會正確解析並顯示在頁面上

給我修復後的完整代碼。
```

### 檢查點

- [ ] 刷新頁面後，之前添加的任務還在
- [ ] 刷新頁面後，任務的完成狀態也保留了
- [ ] 關閉瀏覽器標籤頁，重新打開文件，任務還在

## 技術小貼士：JSON 是什麼？

你可能注意到 AI 的代碼中使用了 `JSON.stringify` 和 `JSON.parse`。這裏簡單解釋一下：

| 方法 | 作用 | 類比 |
|------|------|------|
| `JSON.stringify` | 把數據轉換成文本 | 把衣服疊好裝進行李箱 |
| `JSON.parse` | 把文本轉換回數據 | 從行李箱裏把衣服拿出來 |

因爲 localStorage 只能存儲文本，所以：
- **存的時候**：先用 `JSON.stringify` 把任務列表"打包"成文本
- **取的時候**：再用 `JSON.parse` 把文本"解包"還原成任務列表

你不需要記住這些，只需要知道 AI 生成的代碼中會包含這兩個步驟。

## 本步完成確認

如果你已經：
- ✅ 在開發者工具中能看到 `todoList` 數據
- ✅ 刷新頁面後任務還在
- ✅ 完成狀態也能保留

恭喜！數據存儲功能已經實現。接下來我們做更完整的測試。

→ [4.4.3 測試數據持久化](./4.4.3-test-persistence.md)
