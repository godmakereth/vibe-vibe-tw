---
title: "4.4.3 測試數據持久化"
order: 4
---

# 4.4.3 測試數據持久化

> **本步目標**：通過多種場景驗證數據存儲功能是否完善

在 4.4.2 中，我們已經初步驗證了刷新後數據還在。本節進行更全面的測試，確保各種情況下數據都能正確保存。

## 五步驗證法

按照以下步驟，系統性地測試數據持久化功能：

### 步驟 1：準備測試數據

1. 如果當前有任務，先全部刪除（從一個乾淨的狀態開始）
2. 添加 3 個任務：
   - "學習 Vibe Coding"
   - "完成待辦清單項目"
   - "慶祝一下"

### 步驟 2：修改任務狀態

1. 將 "學習 Vibe Coding" 標記爲已完成
2. 確認它有視覺變化（刪除線或變灰）

### 步驟 3：刷新頁面測試

1. 按 **F5** 或 **Ctrl+R**（Mac: Cmd+R）刷新頁面
2. 檢查結果：

| 檢查項 | 預期結果 |
|--------|---------|
| 任務數量 | 3 個 |
| "學習 Vibe Coding" | 仍然是已完成狀態 |
| 其他兩個任務 | 仍然是未完成狀態 |

### 步驟 4：關閉標籤頁測試

這是更嚴格的測試：

1. 完全關閉當前瀏覽器標籤頁
2. 重新打開 HTML 文件（或重新訪問網址）
3. 檢查結果：任務列表應該和關閉前一樣

### 步驟 5：刪除操作測試

1. 刪除 "慶祝一下" 這個任務
2. 刷新頁面
3. 檢查結果：應該只剩 2 個任務，"慶祝一下" 不應該回來

## 如何查看 localStorage 中的原始數據

有時候需要直接查看存儲的數據內容，可以這樣操作：

1. 按 **F12** 打開開發者工具
2. 點擊 **Application** 標籤
3. 展開左側的 **Storage > Local Storage**
4. 點擊你的網頁地址（如 `file://` 或 `localhost`）
5. 在右側找到 Key 爲 `todoList` 的那一行
6. 雙擊 Value 列可以查看完整內容

**正確的數據格式示例**：

```json
[
  {"text": "學習 Vibe Coding", "completed": true},
  {"text": "完成待辦清單項目", "completed": false}
]
```

::: tip 提示
如果你的數據格式和上面不完全一樣也沒關係，只要包含任務內容和完成狀態兩個信息即可。不同的 AI 可能會使用不同的屬性名（如 `content` 代替 `text`，`done` 代替 `completed`）。
:::

## 測試檢查清單

完成所有測試後，確認以下項目都通過：

- [ ] 添加任務後，刷新頁面任務還在
- [ ] 刪除任務後，刷新頁面任務不會回來
- [ ] 標記完成後，刷新頁面完成狀態保留
- [ ] 取消完成後，刷新頁面狀態正確更新
- [ ] 關閉標籤頁再打開，數據完整保留
- [ ] 在開發者工具中能看到 `todoList` 數據

## 常見問題排查

### 問題 1：刷新後所有任務消失

| 可能原因 | 排查方法 |
|---------|---------|
| 保存邏輯沒執行 | 檢查開發者工具中有沒有 `todoList` |
| 讀取邏輯沒執行 | 有 `todoList` 但頁面空白 |
| 數據格式錯誤 | `todoList` 值是亂碼或 undefined |

**通用修復 Prompt**：
```
刷新頁面後任務都消失了。
我在開發者工具的 Local Storage 中 [能看到/看不到] todoList 數據。
請幫我檢查保存和讀取邏輯，確保：
1. 每次任務變化都會保存到 localStorage
2. 頁面加載時會讀取並顯示保存的數據
給我修復後的完整代碼。
```

### 問題 2：任務內容在，但完成狀態丟失

**可能原因**：保存時沒有包含 `completed` 狀態。

**修復 Prompt**：
```
刷新頁面後任務內容還在，但所有任務都變成未完成狀態了。
請檢查保存邏輯，確保每個任務對象都包含完成狀態（completed 或 done 屬性）。
給我修復後的完整代碼。
```

### 問題 3：刪除的任務刷新後又回來了

**可能原因**：刪除操作後沒有更新 localStorage。

**修復 Prompt**：
```
我刪除了一個任務，但刷新頁面後它又出現了。
請確保刪除任務後會立即更新 localStorage 中的數據。
給我修復後的完整代碼。
```

### 問題 4：控制檯報錯 JSON 相關錯誤

常見報錯如：
- `SyntaxError: Unexpected token`
- `JSON.parse: unexpected character`

**修復 Prompt**：
```
控制檯報錯：[粘貼具體報錯信息]
這似乎是 JSON 解析相關的問題。
請檢查 localStorage 數據的保存和讀取邏輯，確保格式正確。
給我修復後的完整代碼。
```

## 本節檢查點

在繼續之前，確認：

- [ ] 完成了五步驗證法的所有測試
- [ ] 所有測試場景都通過
- [ ] 沒有控制檯報錯

全部通過後，進入最後的完整功能驗證。

→ [4.4.4 完整功能驗證](./4.4.4-final-verification.md)
